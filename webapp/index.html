<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>경주 가족여행</title>
<meta property="og:title" content="경주 가족여행 2026">
<meta property="og:description" content="2026.02.19~24 경주 가족여행 일정 · 식당 · 관광지">
<meta property="og:image" content="https://gyeongju-trip.vercel.app/og-image.png">
<meta property="og:url" content="https://gyeongju-trip.vercel.app">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;500;700&family=Noto+Sans+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* ═══ TOKENS ═══ */
:root {
  --bg: #F7F7F7;
  --surface: #FFFFFF;
  --text-1: #111111;
  --text-2: #999999;
  --text-3: #555555;
  --border: #E5E5E5;
  --divider: #EEEEEE;
  --red: #C41E3A;
  --red-bg: rgba(196,30,58,0.06);
  --blue: #0066CC;
  --blue-bg: rgba(0,102,204,0.06);
  --green: #1A8754;
  --green-bg: rgba(26,135,84,0.08);
  --orange: #C67A2E;
  --orange-bg: rgba(198,122,46,0.06);
  --purple: #6B5B95;
  --purple-bg: rgba(107,91,149,0.06);
  --serif: 'Noto Serif KR', Georgia, serif;
  --mono: 'Noto Sans Mono', 'SF Mono', monospace;
}

/* ═══ DARK MODE ═══ */
[data-theme="dark"] {
  --bg: #111111;
  --surface: #1A1A1A;
  --text-1: #FFFFFF;
  --text-2: #666666;
  --text-3: #999999;
  --border: #2E2E2E;
  --divider: #2E2E2E;
  --red: #FF5C33;
  --red-bg: rgba(255,92,51,0.10);
  --blue: #4D9AFF;
  --blue-bg: rgba(77,154,255,0.10);
  --green: #4CAF50;
  --green-bg: rgba(76,175,80,0.10);
  --orange: #E8A04C;
  --orange-bg: rgba(232,160,76,0.10);
  --purple: #9B8DC7;
  --purple-bg: rgba(155,141,199,0.10);
}
@media(prefers-color-scheme:dark){
  :root:not([data-theme="light"]){
    --bg: #111111; --surface: #1A1A1A; --text-1: #FFFFFF; --text-2: #666666;
    --text-3: #999999; --border: #2E2E2E; --divider: #2E2E2E;
    --red: #FF5C33; --red-bg: rgba(255,92,51,0.10);
    --blue: #4D9AFF; --blue-bg: rgba(77,154,255,0.10);
    --green: #4CAF50; --green-bg: rgba(76,175,80,0.10);
    --orange: #E8A04C; --orange-bg: rgba(232,160,76,0.10);
    --purple: #9B8DC7; --purple-bg: rgba(155,141,199,0.10);
  }
}

/* ═══ FONT SIZE SUPPORT ═══ */
:root[data-fontsize="small"] { --base-font: 14px; --delta: -2px; }
:root[data-fontsize="large"] { --base-font: 18px; --delta: 2px; }

/* ═══ RESET ═══ */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text-1);
  font-family: var(--mono);
  font-size: var(--base-font, 16px);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  min-height: 100dvh;
  overflow-x: hidden;
  transition: background 0.3s ease, color 0.3s ease;
}

/* ═══ LAYOUT ═══ */
.container {
  max-width: 440px;
  margin: 0 auto;
  padding: 0 0 48px;
}

/* ═══ APP HEADER ═══ */
.header, .app-header {
  padding: 32px 24px 20px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
}
.header h1, .app-header h1 {
  font-family: var(--serif);
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--text-1);
}
.header .sub-info, .app-header .sub-info {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-2);
  margin-top: 8px;
  letter-spacing: 1px;
}
.header .update-time, .app-header .update-time {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-2);
  margin-top: 4px;
}

/* ═══ SECTION NAV (4 tabs) ═══ */
.section-nav {
  display: flex;
  max-width: 440px;
  margin: 0 auto;
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
}
.section-nav-btn {
  flex: 1;
  padding: 14px 0;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-2);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  text-align: center;
  letter-spacing: 0.5px;
  transition: all 0.2s;
}
.section-nav-btn.active {
  color: var(--text-1);
  border-bottom-color: var(--text-1);
  font-weight: 600;
}

/* ═══ DAY TABS ═══ */
.day-tabs {
  display: flex;
  gap: 0;
  max-width: 440px;
  margin: 0 auto;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  overflow-x: auto;
  scrollbar-width: none;
}
.day-tabs::-webkit-scrollbar { display: none; }
.day-tab {
  flex: 1 1 0;
  padding: 12px 0;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-2);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  text-align: center;
  white-space: nowrap;
  transition: all 0.2s;
}
.day-tab.active {
  color: var(--text-1);
  border-bottom-color: var(--text-1);
  font-weight: 600;
}
.day-tab .tab-date {
  display: block;
  font-size: 10px;
  color: var(--text-2);
  margin-top: 2px;
}
.day-tab.active .tab-date {
  color: var(--text-3);
}

/* ═══ REST SUB TABS ═══ */
.rest-sub-tabs {
  display: flex;
  gap: 0;
  border-bottom: 1px solid var(--border);
  margin-bottom: 0;
}
.rest-sub-tab {
  flex: 1;
  text-align: center;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  padding: 10px 0;
  border: none;
  border-bottom: 2px solid transparent;
  background: transparent;
  color: var(--text-2);
  cursor: pointer;
  transition: all 0.2s;
}
.rest-sub-tab.active {
  color: var(--text-1);
  border-bottom-color: var(--text-1);
}

/* ═══ SORT BAR ═══ */
.sort-bar {
  display: flex;
  gap: 0;
  border-bottom: 1px solid var(--border);
}
.sort-btn {
  flex: 1;
  padding: 8px 0;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s;
}
.sort-btn.active {
  color: var(--text-1);
  border-bottom-color: var(--text-1);
}

/* ═══ DAY HERO ═══ */
.day-hero {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 32px 24px 24px;
}
.day-hero__num {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-2);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 8px;
}
.day-hero__title {
  font-family: var(--serif);
  font-size: 28px;
  font-weight: 700;
  color: var(--text-1);
  letter-spacing: -0.5px;
  margin-bottom: 6px;
}
.day-hero__date {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-2);
}
.day-hero__progress {
  margin-top: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.day-hero__bar {
  flex: 1;
  height: 3px;
  background: var(--border);
  overflow: hidden;
}
.day-hero__bar-fill {
  height: 100%;
  background: var(--text-1);
  transition: width 0.4s ease;
}
.day-hero__pct {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
  flex-shrink: 0;
}

/* ═══ SECTION SPACER ═══ */
.section-gap {
  height: 12px;
  background: var(--bg);
}

/* ═══ SECTION HERO (legacy — maps to day-hero) ═══ */
.section-hero {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 28px 24px;
  margin-bottom: 0;
  position: relative;
  overflow: hidden;
}
.section-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-2);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 10px;
}
.section-title {
  font-family: var(--serif);
  font-size: 26px;
  font-weight: 700;
  color: var(--text-1);
  letter-spacing: -0.3px;
  line-height: 1.25;
}
.section-subtitle {
  font-family: var(--mono);
  font-size: calc(13px + var(--delta, 0px));
  color: var(--text-2);
  margin-top: 6px;
  font-weight: 400;
}

/* ═══ DISPLAY CARD (legacy — maps to day-hero) ═══ */
.display-card {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  overflow: hidden;
  margin-bottom: 0;
  position: relative;
}
.display-screen { padding: 28px 24px; position: relative; }
.display-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.display-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-2);
  letter-spacing: 2px;
  text-transform: uppercase;
}
.display-indicator { display: flex; gap: 4px; }
.display-indicator span {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--border); transition: background 0.3s;
}
.display-indicator span.on { background: var(--text-1); }
.day-title-display {
  font-family: var(--serif);
  font-size: 26px;
  font-weight: 700;
  color: var(--text-1);
  margin-bottom: 6px;
  letter-spacing: -0.3px;
  line-height: 1.25;
}
.day-subtitle {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--text-2);
  font-weight: 400;
}

/* level meter (legacy — maps to day-hero progress) */
.level-meter { padding: 0 24px 20px; }
.meter-bar { height: 3px; background: var(--border); position: relative; overflow: visible; }
.meter-fill { height: 100%; background: var(--text-1); transition: width 0.4s ease; }
.meter-ticks { display: flex; justify-content: space-between; margin-top: 8px; }
.meter-tick { font-family: var(--mono); font-size: 10px; color: var(--text-2); letter-spacing: 0.3px; }

/* ═══ CONTEXT HEADER ═══ */
.ctx {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 24px;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
}
.ctx__left {
  display: flex;
  align-items: center;
  gap: 8px;
}
.ctx__dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  flex-shrink: 0;
}
.ctx__dot--meal { background: var(--blue); }
.ctx__dot--activity { background: var(--green); }
.ctx__dot--move { background: var(--orange); }
.ctx__dot--stay { background: var(--purple); }
.ctx__label {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-3);
}
.ctx__right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.ctx__cat {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 600;
}
.ctx__cat--meal { color: var(--red); }
.ctx__cat--activity { color: var(--green); }
.ctx__cat--move { color: var(--orange); }
.ctx__cat--stay { color: var(--purple); }
.ctx__status {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  padding: 2px 6px;
  border: 1px solid var(--border);
  color: var(--text-2);
}
.ctx__status--done {
  border-color: var(--green);
  color: var(--green);
}

/* ═══ SECTION TITLE ═══ */
.sec-title {
  background: var(--surface);
  padding: 20px 24px 24px;
  border-bottom: 1px solid var(--border);
}
.sec-title__text {
  font-family: var(--serif);
  font-size: 24px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--text-1);
}
.sec-title__sub {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-2);
  margin-top: 4px;
}

/* ═══ CONTENT CARD ═══ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* ═══ CARD (legacy accordion — places/restaurants/stay) ═══ */
.card[open] { /* no shadow change */ }
.card > summary {
  list-style: none;
  cursor: pointer;
  user-select: none;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.card > summary::-webkit-details-marker { display: none; }
.card-top { display: flex; align-items: center; justify-content: space-between; }
.card-name {
  font-family: var(--serif);
  font-size: calc(var(--base-font, 16px) + 2px);
  font-weight: 700;
  color: var(--text-1);
  line-height: 1.3;
  flex: 1;
  min-width: 0;
}
.card-chevron {
  width: 20px; height: 20px;
  display: flex; align-items: center; justify-content: center;
  color: var(--text-2);
  transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
  flex-shrink: 0;
  margin-left: 12px;
}
.card-chevron svg { width: 12px; height: 12px; }
.card[open] .card-chevron { transform: rotate(90deg); }
.card-sub {
  font-family: var(--mono);
  font-size: calc(13px + var(--delta, 0px));
  color: var(--text-2);
  margin-top: 3px;
  line-height: 1.4;
  padding-right: 32px;
}
.card-body {
  border-top: 1px solid var(--border);
  margin: 0 0;
  padding: 16px 0 18px;
}
.card__body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 16px;
}

/* ═══ PLACE CARD ═══ */
.place__name {
  font-family: var(--serif);
  font-size: 20px;
  font-weight: 700;
  color: var(--text-1);
}
.place__sub {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-2);
  line-height: 1.6;
}

/* ═══ MUST-DO ═══ */
.must-do__title {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-2);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 8px;
}
.must-do__item {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-1);
  line-height: 1.7;
  padding-left: 16px;
  position: relative;
}
.must-do__item::before {
  content: '\00B7';
  position: absolute;
  left: 4px;
  color: var(--text-2);
  font-weight: 600;
}

/* ═══ BABY TIPS ═══ */
.baby-tips__title {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-2);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 8px;
}

/* ═══ MOVE CARD ═══ */
.move__route {
  display: flex;
  align-items: center;
  gap: 12px;
}
.move__from, .move__to {
  font-family: var(--serif);
  font-size: 16px;
  font-weight: 500;
  color: var(--text-1);
}
.move__arrow {
  font-family: var(--mono);
  font-size: 14px;
  color: var(--text-2);
  flex-shrink: 0;
}
.move__detail {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-2);
  line-height: 1.6;
}

/* ═══ RESTAURANT CARD ═══ */
.rest__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.rest__name {
  font-family: var(--serif);
  font-size: 20px;
  font-weight: 700;
  color: var(--text-1);
}
.rest__right {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}
.rest__score {
  font-family: var(--mono);
  font-size: 16px;
  font-weight: 600;
  color: var(--text-1);
}
.rest__sub {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-2);
}

/* ═══ BADGE ═══ */
.badge {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  padding: 3px 8px;
  border: 1px solid var(--green);
  color: var(--green);
  background: var(--green-bg);
  display: inline-block;
}
.badge--closed {
  border-color: var(--border);
  color: var(--text-2);
  background: transparent;
}

/* legacy badge classes */
.badge-dad-good { border: 1px solid var(--green); background: var(--green-bg); color: var(--green); }
.badge-dad-caution { border: 1px solid var(--orange); background: var(--orange-bg); color: var(--orange); }
.badge-hiro-good { border: 1px solid var(--blue); background: var(--blue-bg); color: var(--blue); }
.badge-hiro-caution { border: 1px solid var(--red); background: var(--red-bg); color: var(--red); }
.option-badges, .badges { margin-top: 10px; display: flex; gap: 6px; flex-wrap: wrap; }

/* ═══ HR / DIVIDER ═══ */
.hr { height: 1px; background: var(--border); }

/* ═══ MENU TABLE ═══ */
.menu-row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  padding: 8px 0;
}
.menu-row + .menu-row { border-top: 1px solid var(--divider); }
.menu-row__name {
  font-family: var(--serif);
  font-size: 14px;
  font-weight: 400;
  color: var(--text-1);
}
.menu-row__price {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-1);
  flex-shrink: 0;
  margin-left: 16px;
}

/* ═══ INFO TABLE ═══ */
.info-row {
  display: flex;
  align-items: baseline;
  gap: 16px;
}
.info-row + .info-row { margin-top: 8px; }
.info-row__label {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-2);
  flex-shrink: 0;
  min-width: 52px;
}
.info-row__value {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-1);
}

/* ═══ TAGS ═══ */
.tags { display: flex; flex-wrap: wrap; gap: 8px; }
.tag {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 400;
  color: var(--text-3);
  padding: 4px 10px;
  border: 1px solid var(--border);
}

/* ═══ MAP LINK ═══ */
.map-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--blue);
  text-decoration: none;
}
.map-link:hover { text-decoration: underline; }
.map-link svg {
  width: 14px; height: 14px;
  stroke: currentColor; fill: none; stroke-width: 2;
}

/* ═══ CHEVRON ═══ */
.chevron {
  display: flex;
  align-items: center;
  gap: 4px;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 400;
  color: var(--text-2);
}
.chevron svg {
  width: 14px; height: 14px;
  stroke: currentColor; fill: none; stroke-width: 2;
}

/* ═══ ALT SECTION ═══ */
.alt__header {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.alt__title {
  font-family: var(--serif);
  font-size: 16px;
  font-weight: 500;
  color: var(--text-1);
}
.alt__dash {
  font-family: var(--mono);
  font-size: 14px;
  color: #CCCCCC;
}
[data-theme="dark"] .alt__dash { color: #444444; }
.alt__desc {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 400;
  color: var(--text-2);
}

/* ═══ ACCORDION ═══ */
details.card {
  cursor: default;
}
details.card > summary {
  list-style: none;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
details.card > summary::-webkit-details-marker { display: none; }
details.card > summary .chevron svg {
  transition: transform 0.25s ease;
}
details.card[open] > summary .chevron svg {
  transform: rotate(90deg);
}
details.card > .card__body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 16px;
}

/* ═══ STAGGER ANIMATION ═══ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}
.section {
  animation: fadeIn 0.35s ease both;
}
.section:nth-child(2) { animation-delay: 0.03s; }
.section:nth-child(3) { animation-delay: 0.06s; }
.section:nth-child(4) { animation-delay: 0.09s; }
.section:nth-child(5) { animation-delay: 0.12s; }
.section:nth-child(6) { animation-delay: 0.15s; }
.section:nth-child(7) { animation-delay: 0.18s; }
.section:nth-child(8) { animation-delay: 0.21s; }
.section:nth-child(9) { animation-delay: 0.24s; }
.section:nth-child(10) { animation-delay: 0.27s; }
.section:nth-child(11) { animation-delay: 0.30s; }
.section:nth-child(12) { animation-delay: 0.33s; }
@media (prefers-reduced-motion: reduce) {
  .section { animation: none; }
}

/* fade animation (legacy) */
.fade-up { opacity: 0; transform: translateY(16px); animation: fadeUp 0.5s cubic-bezier(0.4,0,0.2,1) forwards; }
@keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

/* ═══ ITEM CARDS (schedule — legacy) ═══ */
.items-list { padding: 0 0 8px; }
.item-card {
  background: var(--surface);
  border: 1px solid var(--border);
  margin-bottom: 12px;
  overflow: hidden;
}
.item-card.visited { border-left: 3px solid var(--green); }
.item-card.skipped { opacity: 0.7; }
.item-display { padding: 18px 20px; }
.item-top-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.item-status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.item-status-dot.planned { background: var(--text-2); }
.item-status-dot.done { background: var(--green); }
.item-status-dot.skipped { background: var(--red); }
.item-status-check {
  width: 16px; height: 16px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 50%; background: var(--green); color: #fff; font-size: 10px; flex-shrink: 0;
}
.item-time {
  font-family: var(--mono);
  font-size: calc(12px + var(--delta, 0px));
  color: var(--text-2);
  letter-spacing: 0.5px;
  font-weight: 500;
}
.item-cat-label {
  font-family: var(--mono);
  font-size: calc(12px + var(--delta, 0px));
  color: var(--red);
  margin-left: auto;
  font-weight: 500;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}
.item-title {
  font-family: var(--serif);
  font-size: calc(18px + var(--delta, 0px));
  font-weight: 700;
  color: var(--text-1);
  letter-spacing: -0.2px;
  line-height: 1.3;
}
.item-title.skipped { text-decoration: line-through; color: var(--text-2); }
.item-visited-info {
  font-family: var(--mono);
  font-size: 14px;
  color: var(--green);
  font-weight: 600;
  margin-left: 8px;
}
.item-note-row {
  padding: 12px 20px 14px;
  font-family: var(--mono);
  font-size: 14px;
  color: var(--text-3);
  border-top: 1px solid var(--border);
}
.item-note-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
  margin-bottom: 4px;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}
.item-distance {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-2);
  margin-top: 4px;
  letter-spacing: 0.2px;
}
.item-distance.nearby { color: var(--green); font-weight: 600; }
.item-distance.far-away { color: var(--text-2); }

/* ═══ OPTIONS LIST (schedule — legacy) ═══ */
.options-list { margin-top: 12px; border-top: 1px solid var(--border); padding-top: 12px; }

/* option card (accordion) */
.option-card {
  margin-bottom: 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  overflow: hidden;
  transition: border-color 0.3s;
}
.option-card[open] { border-color: var(--text-2); }
.option-card > summary {
  padding: 12px 14px;
  cursor: pointer;
  list-style: none;
  -webkit-tap-highlight-color: transparent;
}
.option-card > summary::-webkit-details-marker { display: none; }
.option-top { display: flex; align-items: center; gap: 8px; }
.option-name {
  font-family: var(--serif);
  font-size: calc(14px + var(--delta, 0px));
  font-weight: 700;
  color: var(--text-1);
  flex: 1;
  min-width: 0;
}
.option-rating {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-1);
}
.option-chevron {
  color: var(--text-2);
  flex-shrink: 0;
  transition: transform 0.2s;
  display: flex;
}
.option-card[open] .option-chevron { transform: rotate(90deg); }
.option-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 4px;
  font-size: 13px;
  color: var(--text-2);
}
.option-menu-brief { flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.open-tag {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  padding: 3px 8px;
  letter-spacing: 0.3px;
  flex-shrink: 0;
  border: 1px solid var(--border);
}
.open-tag.open { border-color: var(--green); color: var(--green); background: var(--green-bg); }
.open-tag.closed { border-color: var(--red); color: var(--red); background: var(--red-bg); }
.option-dist { font-family: var(--mono); font-size: 11px; color: var(--text-2); flex-shrink: 0; }
.option-body { padding: 0 14px 14px; border-top: 1px solid var(--border); margin-top: 0; padding-top: 12px; }
.option-info {
  font-size: calc(13px + var(--delta, 0px));
  color: var(--text-3);
  padding: 3px 0;
  display: flex;
  justify-content: space-between;
}
.option-info-label { font-weight: 600; color: var(--text-2); margin-right: 8px; flex-shrink: 0; }
.option-map-link {
  display: flex;
  align-items: center;
  gap: 4px;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--blue);
  text-decoration: none;
  margin-top: 10px;
  letter-spacing: 0.3px;
}
.option-map-link:active { opacity: 0.7; }

/* option simple */
.option-simple {
  padding: 10px 14px;
  margin-bottom: 8px;
  font-family: var(--mono);
  font-size: 14px;
  color: var(--text-3);
  background: var(--bg);
  border: 1px solid var(--border);
}
.option-simple .option-name { font-family: var(--mono); font-size: 14px; }

/* visited badge */
.visit-badge {
  display: inline-flex; align-items: center; justify-content: center;
  width: 20px; height: 20px; border-radius: 50%;
  background: var(--green); color: white; font-size: 11px; margin-left: 6px;
}
.card.visited { border-left: 3px solid var(--green); }
.option-card.visited { border-left: 3px solid var(--green); }

/* review text */
.review-text {
  font-size: calc(12px + var(--delta, 0px));
  color: var(--text-3);
  font-style: italic;
  padding: 4px 0;
  line-height: 1.4;
}

/* ═══ PLACE DETAIL (inside schedule item — legacy) ═══ */
.place-detail {
  margin: 10px 0 8px;
  background: var(--bg);
  border: 1px solid var(--border);
  overflow: hidden;
  transition: border-color 0.3s;
}
.place-detail[open] { border-color: var(--text-2); }
.place-detail[open] .option-chevron { transform: rotate(90deg); }
.place-detail summary { padding: 12px 14px; cursor: pointer; list-style: none; -webkit-tap-highlight-color: transparent; }
.place-detail summary::-webkit-details-marker { display: none; }
.place-detail-top { display: flex; align-items: center; gap: 8px; }
.place-detail-name {
  font-family: var(--serif);
  font-size: calc(15px + var(--delta, 0px));
  font-weight: 600;
  color: var(--text-1);
  flex: 1;
  min-width: 0;
}
.place-detail-hours { font-family: var(--mono); font-size: 12px; color: var(--text-2); flex-shrink: 0; }
.place-detail-sub { font-size: 13px; color: var(--text-3); margin-top: 4px; line-height: 1.4; padding-right: 28px; }
.place-detail-tags { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }
.place-tag { font-family: var(--mono); font-size: 10px; padding: 3px 8px; border: 1px solid var(--border); color: var(--text-3); }
.place-tag.baby { border-color: var(--orange); color: var(--orange); background: var(--orange-bg); }
.place-detail-body { padding: 0 14px 14px; border-top: 1px solid var(--border); padding-top: 12px; }
.place-body-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
  letter-spacing: 0.3px;
  margin: 12px 0 6px;
  text-transform: uppercase;
}
.place-body-label:first-child { margin-top: 0; }
.place-info-row { font-size: calc(13px + var(--delta, 0px)); color: var(--text-3); padding: 3px 0; }
.place-info-label { font-weight: 600; color: var(--text-2); margin-right: 8px; }

/* place guide cards */
.place-section { padding: 0 0 14px; }
.place-section-label {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  color: var(--red);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.place-list { list-style: none; }
.place-list li {
  font-size: calc(13px + var(--delta, 0px));
  color: var(--text-3);
  padding: 5px 0 5px 14px;
  position: relative;
  line-height: 1.55;
}
.place-list li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 13px;
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--red);
}

.baby-tip { background: var(--blue-bg); padding: 14px 16px; margin-bottom: 10px; border: 1px solid var(--border); }
.baby-tip-label {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  color: var(--blue);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 5px;
}
.baby-tip-text { font-size: 13px; color: var(--text-1); line-height: 1.55; }

.info-grid { display: grid; grid-template-columns: auto 1fr; gap: 6px 12px; font-size: 13px; }
.info-label { color: var(--text-2); font-weight: 600; white-space: nowrap; }
.info-value { color: var(--text-3); line-height: 1.4; font-size: calc(13px + var(--delta, 0px)); }

/* ═══ RESTAURANT CARDS (legacy) ═══ */
.rest-rating { font-family: var(--mono); font-size: 14px; font-weight: 500; color: var(--text-1); margin-left: 8px; flex-shrink: 0; }
.rest-meta {
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  font-size: calc(var(--base-font, 16px) - 3px); color: var(--text-2); margin-top: 4px;
}
.rest-menu-brief { color: var(--text-3); font-size: calc(13px + var(--delta, 0px)); }
.rest-status-row { display: flex; align-items: center; gap: 8px; margin-top: 4px; }
.rest-dist { font-family: var(--mono); font-size: 11px; color: var(--text-2); }
.rest-info { font-size: 13px; color: var(--text-3); padding: 3px 0; }
.rest-info-label { font-weight: 600; color: var(--text-2); margin-right: 6px; }
.rest-meals { margin-top: 10px; font-family: var(--mono); font-size: 11px; color: var(--text-2); letter-spacing: 0.3px; }
.rest-map-link {
  display: inline-flex; align-items: center; gap: 4px; margin-top: 10px;
  font-size: 12px; font-weight: 600; color: var(--blue); text-decoration: none;
  border-bottom: 1px solid var(--blue-bg); padding-bottom: 2px; transition: opacity 0.15s;
}
.rest-map-link:active { opacity: 0.6; }

/* ═══ STAY (legacy) ═══ */
.stay-room-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-bottom: 16px; }
.stay-room-chip { background: var(--bg); border: 1px solid var(--border); padding: 14px 10px; text-align: center; }
.stay-room-label { font-family: var(--mono); font-size: 14px; font-weight: 500; color: var(--text-1); }
.stay-room-detail { font-size: 11px; color: var(--text-2); margin-top: 4px; line-height: 1.4; }
.amenity-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.amenity-tag { font-size: 12px; color: var(--text-3); background: var(--bg); border: 1px solid var(--border); padding: 5px 10px; }
.highlight-box { background: var(--red-bg); border: 1px solid var(--border); padding: 14px 16px; margin-bottom: 10px; }
.highlight-label { font-family: var(--mono); font-size: 10px; font-weight: 500; color: var(--red); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 5px; }
.highlight-text { font-size: 13px; color: var(--text-1); line-height: 1.55; }
.link-row { display: flex; gap: 8px; margin-top: 12px; }
.link-btn {
  flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px;
  padding: 11px 8px; font-size: 13px; font-weight: 600; text-decoration: none;
  transition: all 0.2s; border: 1px solid var(--border);
}
.link-btn:active { transform: scale(0.97); }
.link-btn-outline { color: var(--text-3); border: 1px solid var(--border); background: var(--surface); }
.link-btn-solid { color: var(--surface); border: none; background: var(--text-1); }

/* ═══ THEME TOGGLE ═══ */
.theme-toggle {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 200;
  width: 36px;
  height: 36px;
  border: 1px solid var(--border);
  border-radius: 50%;
  background: var(--surface);
  color: var(--text-1);
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.theme-toggle:active { transform: scale(0.92); }
.theme-toggle svg { width: 16px; height: 16px; }

/* ═══ FONT SIZE TRIGGER ═══ */
.font-size-trigger {
  position: fixed;
  top: 12px;
  right: 56px;
  z-index: 200;
  width: 36px;
  height: 36px;
  border: 1px solid var(--border);
  border-radius: 50%;
  background: var(--surface);
  color: var(--text-1);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  font-family: var(--serif);
  font-size: 14px;
  font-weight: 700;
}
.font-size-trigger:active { transform: scale(0.92); }

/* ═══ LOCATION BANNER ═══ */
.location-banner { max-width: 440px; margin: 0 auto; padding: 0; }
.location-banner .banner-device { background: var(--surface); border: 1px solid var(--border); overflow: hidden; }
.location-banner .screen { background: var(--bg); padding: 20px 16px; text-align: center; border-bottom: 1px solid var(--border); }
.location-banner .screen p { font-family: var(--mono); font-size: 13px; color: var(--text-1); line-height: 1.6; }
.location-banner .banner-buttons { display: flex; gap: 0; }
.location-banner .btn-primary {
  flex: 1; padding: 14px 0; font-family: var(--mono); font-size: 13px; font-weight: 600;
  color: var(--surface); background: var(--text-1); border: none; cursor: pointer;
}
.location-banner .btn-secondary {
  flex: 1; padding: 14px 0; font-family: var(--mono); font-size: 13px; font-weight: 500;
  color: var(--text-2); background: var(--surface); border: none; border-left: 1px solid var(--border); cursor: pointer;
}

/* ═══ REFRESH BUTTON ═══ */
.refresh-btn {
  display: none;
  background: var(--surface);
  border: 1px solid var(--border);
  padding: 5px 12px;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-2);
  cursor: pointer;
  margin-top: 8px;
}
.refresh-btn.visible { display: inline-block; }

/* ═══ ERROR / TOAST / LOADING ═══ */
.error-banner {
  max-width: 440px;
  margin: 0 auto;
  padding: 12px 16px;
  font-family: var(--mono);
  font-size: 13px;
  text-align: center;
  color: var(--red);
  background: var(--red-bg);
  display: none;
  border: 1px solid var(--border);
}
.error-banner.show { display: block; }
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(-100px);
  background: var(--text-1);
  color: var(--bg);
  padding: 14px 28px;
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 600;
  z-index: 400;
  transition: transform 0.3s;
}
.toast.show { transform: translateX(-50%) translateY(0); }
.loading {
  text-align: center;
  padding: 80px 20px;
  color: var(--text-2);
  font-family: var(--mono);
  font-size: 13px;
}
.loading .spinner {
  display: inline-block;
  width: 24px;
  height: 24px;
  border: 2px solid var(--border);
  border-top-color: var(--text-1);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: 14px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ═══ FOOTER ═══ */
.footer {
  text-align: center;
  padding: 24px 16px 48px;
  border-top: 1px solid var(--border);
}
.footer-note {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-2);
  letter-spacing: 0.3px;
}
</style>
</head>
<body>

<button class="font-size-trigger" id="fontSizeTrigger" onclick="cycleFontSize()" aria-label="글자 크기">가</button>

<button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="테마 전환">
  <svg id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
</button>

<div class="app-header">
  <h1>경주 가족여행</h1>
  <div class="sub-info"><span id="tripStatus">2026.02.19 thu — 02.24 tue</span></div>
  <div class="update-time" id="updateTime"></div>
  <button class="refresh-btn" id="refreshBtn" onclick="requestLocation()">위치 갱신</button>
</div>

<!-- 위치 안내 배너 -->
<div class="location-banner" id="locationBanner" style="display:none;">
  <div class="banner-device">
    <div class="screen"><p>위치를 켜면 각 장소까지<br>거리를 확인할 수 있습니다</p></div>
    <div class="banner-buttons">
      <button class="btn-primary" onclick="requestLocation()">위치 켜기</button>
      <button class="btn-secondary" onclick="dismissLocationBanner()">괜찮습니다</button>
    </div>
  </div>
</div>

<div class="error-banner" id="errorBanner"></div>

<!-- 상단 4탭 네비게이션 -->
<div class="section-nav">
  <button class="section-nav-btn active" data-tab="schedule" onclick="switchTab('schedule')">일정</button>
  <button class="section-nav-btn" data-tab="places" onclick="switchTab('places')">장소</button>
  <button class="section-nav-btn" data-tab="restaurants" onclick="switchTab('restaurants')">식당</button>
  <button class="section-nav-btn" data-tab="stay" onclick="switchTab('stay')">숙소</button>
</div>

<!-- 일정 서브탭 (Day) -->
<div class="day-tabs" id="dayTabs"></div>

<!-- 식당 서브탭+정렬 -->
<div id="restSubTabsWrap" style="display:none;max-width:440px;margin:0 auto;padding:0 16px;">
  <div class="rest-sub-tabs" id="restSubTabs"></div>
  <div class="sort-bar" id="sortBar"></div>
</div>

<div class="container">
  <div id="contentArea">
    <div class="loading"><div class="spinner"></div><div>불러오는 중...</div></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
// ═══ THEME ═══
function initTheme(){
  var saved=localStorage.getItem('gj_theme');
  document.documentElement.setAttribute('data-theme',saved||'light');
  updateThemeIcon();
}
function toggleTheme(){
  var current=document.documentElement.getAttribute('data-theme');
  var isDark=current==='dark'||(!current&&window.matchMedia('(prefers-color-scheme:dark)').matches);
  var next=isDark?'light':'dark';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('gj_theme',next);
  updateThemeIcon();
}
function updateThemeIcon(){
  var theme=document.documentElement.getAttribute('data-theme');
  var isDark=theme==='dark'||(!theme&&window.matchMedia('(prefers-color-scheme:dark)').matches);
  var el=document.getElementById('themeIcon');
  if(el) el.innerHTML=isDark
    ?'<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>'
    :'<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
}
initTheme();

// ═══ FONT SIZE ═══
var fontSizes=['medium','large','small'];
function initFontSize(){
  var saved=localStorage.getItem('gj_fontsize')||'large';
  document.documentElement.setAttribute('data-fontsize',saved);
  updateFontSizeIcon(saved);
}
function cycleFontSize(){
  var current=document.documentElement.getAttribute('data-fontsize')||'medium';
  var idx=fontSizes.indexOf(current);
  var next=fontSizes[(idx+1)%fontSizes.length];
  document.documentElement.setAttribute('data-fontsize',next);
  localStorage.setItem('gj_fontsize',next);
  updateFontSizeIcon(next);
}
function updateFontSizeIcon(size){
  var btn=document.getElementById('fontSizeTrigger');
  if(!btn) return;
  var labels={small:'가-',medium:'가',large:'가+'};
  btn.textContent=labels[size];
}
initFontSize();

// ═══ UTILS ═══
function esc(s){if(!s) return '';var d=document.createElement('div');d.textContent=s;return d.innerHTML}
function escAttr(s){return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
var escapeHtml=esc;
var escapeAttr=escAttr;
function formatDate(s){var p=s.split('-');return parseInt(p[1])+'/'+parseInt(p[2])}
function formatPrice(n){return n?n.toLocaleString()+'원':''}
function formatTabDate(dateStr){var parts=dateStr.split('-');return parseInt(parts[1])+'/'+parseInt(parts[2])}
function formatDateTime(d){
  var mm=String(d.getMonth()+1).padStart(2,'0');
  var dd=String(d.getDate()).padStart(2,'0');
  var hh=String(d.getHours()).padStart(2,'0');
  var mi=String(d.getMinutes()).padStart(2,'0');
  return mm+'.'+dd+' '+hh+':'+mi;
}

function showError(msg){var el=document.getElementById('errorBanner');el.textContent=msg;el.classList.add('show')}
function hideError(){document.getElementById('errorBanner').classList.remove('show')}
function showToast(msg){var t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},2000)}

// ═══ GLOBALS ═══
var travelData=null;
var activeDay=0;
var activeTab='schedule';
// polling removed — data refresh triggered by chatbot on change

// restaurant state
var allRestaurants=[];
var restSortMode='rating';
var restTypeFilter='all';

// location state
var userLat=null;
var userLng=null;
var locationTimestamp=0;
var gpsWarningShown=false;
var GEO_OPTIONS={enableHighAccuracy:false,timeout:10000,maximumAge:300000};

// test location
(function(){
  var params=new URLSearchParams(location.search);
  if(params.get('testloc')==='1'){
    userLat=35.8579382;userLng=129.262038;
    restSortMode='distance';
  }
})();
</script>
<script>
// ═══ STAY DATA ═══
var STAY_DATA={
  name:'까사멜로우',nameEn:'Casa Mellow',
  desc:'아이와 함께하는 서툰 여행을 응원하며',
  address:'경상북도 경주시 북군4길 75',
  phone:'010-3583-6648',email:'ssoong6648@naver.com',
  instagram:'@casa.mellow',
  checkin:'15:30',checkout:'11:00',
  parking:'건물 외부 전용 주차장',
  mapUrl:'https://map.naver.com/p/search/까사멜로우 경주',
  stayfolioUrl:'https://www.stayfolio.com/findstay/casa-mellow',
  rooms:[
    {name:'A-1',type:'복층',people:'4/8명',bed:'Q2 + S1',bath:'2.5',price:'289,000~'},
    {name:'A-2',type:'복층',people:'4/8명',bed:'Q2 + S1',bath:'2.5',price:'329,000~'},
    {name:'B',type:'독채',people:'4/8명',bed:'4개',bath:'2',price:'329,000~'}
  ],
  amenities:{
    kitchen:['인덕션','전자레인지','식기세척기','토스터기','캡슐커피머신','전기포트','제빙기','조리도구','기본조미료','와인잔'],
    bath:['샴푸','컨디셔너','바디워시','핸드워시','치약','타월','샤워가운'],
    general:['TV','냉장고','세탁기','헤어드라이어','스피커','슬리퍼','생수'],
    baby:['젖병소독기','유아용 어메니티','유아 샤워용품','키즈가구']
  },
  kids:['실내 키즈룸 (미끄럼틀, 놀이기구)','야외 모래 놀이터','미니 바이킹','전 객실 키즈 어메니티'],
  pool:{depth:'약 70cm',note:'온수 풀 · 사계절 이용 · 시간 제한 없음 · 보호자 동반 필수'},
  bbq:{note:'무료 이용 · 전기그릴 기본 제공 · 시간 제한 없음',extra:'웨버 가스그릴 추가 가능 (유료)'},
  rules:['전 공간 절대 금연','실내 냄새나는 음식 조리 금지','퇴실 전 정리 및 분리수거','야간 소음 주의','24개월 미만 영유아 무료','기준인원 초과 시 1인 1박 30,000원']
};

// ═══ PATCH DATA ═══
function patchGuideData(days){
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.title&&item.title.indexOf('홈플러스')!==-1&&!item.guide){
        item.guide={
          placeName:'홈플러스',
          subtitle:'경주 유일의 대형 할인점 · 2024 메가푸드마켓 리뉴얼',
          mustDo:['BBQ 식재료·간식·음료 장보기','아기 간식·이유식 재료 확보'],
          babyTips:{
            stroller:'단층 매장이라 유모차 이동 편리',
            nursingRoom:'매장 내 수유실 (전화확인: 054-770-8000)',
            restSpots:['수퍼윙스 키즈카페 (1층)']
          },
          practicalInfo:{
            hours:'09:00~22:00',
            parking:'1층 고객주차장 + 2층 옥상주차장 (유료, 구매시 무료)',
            phone:'054-770-8000',
            closedDays:'매월 둘째·넷째 일요일 (\u26A0\uFE0F 2/22 휴무!)',
            address:'경상북도 경주시 공단로 97',
            fromAccommodation:'까사멜로우에서 차량 약 15분',
            mapUrl:'https://map.naver.com/p/search/홈플러스%20경주점'
          }
        };
      }
      // subPlaces
      if(item.title==='대릉원(천마총) + 첨성대'&&!item.subPlaces){
        item.subPlaces=[
          {name:'대릉원(천마총)',subtitle:'신라 왕릉 23기 거대 고분군 · 유모차 산책 코스',guide:{mustDo:['천마총 내부 관람 (경주 유일 고분 내부 공개)','고분 사이 잔디 산책 · 목련나무 포토존','무료 문화해설 (매시 정각, 10~16시)'],babyTips:{stroller:'전체 평지, 유모차 매우 편리. 정문에서 대여 가능',nursingRoom:'주차장 부근 수유실 (054-750-8655)'},practicalInfo:{fee:'대릉원 무료 / 천마총 3,000원 (만6세 이하 무료)',hours:'09:00~22:00 (매표 21:30)',parking:'쪽샘지구 공영주차장 무료 (추천)',mapUrl:'https://map.naver.com/p/search/대릉원'}}},
          {name:'첨성대',subtitle:'동양 최고(最古) 천문대 · 국보 제31호',guide:{mustDo:['1,300년 원형 유지 신라 천문관측대 감상','야간 조명도 아름다움'],babyTips:{stroller:'주변 평지, 유모차 이동 편리'},practicalInfo:{fee:'무료',hours:'09:00~22:00',fromAccommodation:'대릉원에서 도보 5분',mapUrl:'https://map.naver.com/p/search/첨성대'}}}
        ];
      }
      if(item.title==='교촌마을 산책'&&!item.subPlaces){
        item.subPlaces=[
          {name:'교촌 한옥마을',subtitle:'신라 천년 한옥마을 · 돌담길 산책',guide:{mustDo:['한옥 골목 산책 + 돌담길 포토존','월정교 야경 (도보 5분)'],babyTips:{stroller:'대부분 평지, 일부 돌길. 바퀴 큰 유모차 권장'},practicalInfo:{fee:'무료',hours:'마을 24시간 개방',parking:'월정교 공영주차장 무료 (교동 153-5)',mapUrl:'https://map.naver.com/p/search/교촌한옥마을'}}},
          {name:'경주 최부자댁',subtitle:'12대 만석꾼 명문가 · 중요민속문화재',guide:{mustDo:['6가지 가훈으로 유명한 명문가 탐방','교동법주 시음 (최부자댁 옆)'],babyTips:{stroller:'내부 마당 평탄, 유모차 가능'},practicalInfo:{fee:'무료',hours:'~17:00',mapUrl:'https://map.naver.com/p/search/경주최부자댁'}}}
        ];
      }
      // placeName 패치: 장소 카드에서 행위 분리
      if(item.guide&&!item.guide.placeName){
        if(item.title&&item.title.indexOf('동궁과 월지')!==-1) item.guide.placeName='동궁과 월지';
        if(item.title&&item.title.indexOf('보문호수')!==-1) item.guide.placeName='보문호수';
      }
    });
  });
}

// ═══ PLACE COORDS ═══
var PLACE_COORDS={
  '동궁과 월지':{lat:35.835202,lng:129.228375},
  '대릉원(천마총)':{lat:35.839185,lng:129.210721},
  '첨성대':{lat:35.834375,lng:129.218564},
  '교촌 한옥마을':{lat:35.829675,lng:129.214723},
  '경주 최부자댁':{lat:35.830100,lng:129.214200},
  '불국사':{lat:35.789273,lng:129.331848},
  '보문호수':{lat:35.844327,lng:129.276681},
  '경주 동궁원':{lat:35.840500,lng:129.279800},
  '국립경주박물관':{lat:35.831700,lng:129.228300},
  '홈플러스 경주점':{lat:35.873420,lng:129.224800},
  '사랑의 소아과의원':{lat:35.843300,lng:129.213500}
};
function getPlaceDistKm(name){
  if(!userLat) return null;
  var c=PLACE_COORDS[name];
  if(!c) return null;
  return haversineKm(userLat,userLng,c.lat,c.lng);
}

// ═══ DISTANCE ═══
function haversineKm(lat1,lng1,lat2,lng2){
  var R=6371;var dLat=(lat2-lat1)*Math.PI/180;var dLng=(lng2-lng1)*Math.PI/180;
  var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)*Math.sin(dLng/2);
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}
var haversineDistance=haversineKm;

function formatDistance(km){
  if(km>=50) return {text:'현재 경주 근처가 아닙니다',cls:'far-away'};
  if(km<1){var walkMin=Math.round((km*1000)/67);return {text:'도보 약 '+walkMin+'분 ('+km.toFixed(1)+'km)',cls:'nearby'};}
  var driveMin=Math.round(km/30*60);
  if(km<5) return {text:'약 '+km.toFixed(1)+'km · 차량 약 '+driveMin+'분',cls:''};
  return {text:'약 '+Math.round(km)+'km · 차량 약 '+driveMin+'분',cls:''};
}

function getItemDistance(item){
  if(!userLat||!item.options||item.options.length===0) return null;
  var withCoords=item.options.filter(function(o){return o.lat&&o.lng});
  if(withCoords.length===0) return null;
  if(item.visitedOption){
    var visited=withCoords.find(function(o){return o.name===item.visitedOption});
    if(visited) return {km:haversineKm(userLat,userLng,visited.lat,visited.lng),name:visited.name};
  }
  var closest=null;var minKm=Infinity;
  withCoords.forEach(function(o){var km=haversineKm(userLat,userLng,o.lat,o.lng);if(km<minKm){minKm=km;closest=o}});
  return closest?{km:minKm,name:closest.name}:null;
}

function parseOpenClosed(hoursStr){
  if(!hoursStr) return null;
  var m=hoursStr.match(/(\d{1,2}):?(\d{2})?\s*[~\-]\s*(\d{1,2}):?(\d{2})?/);
  if(!m) return null;
  var now=new Date();
  var nowMin=now.getHours()*60+now.getMinutes();
  var openMin=parseInt(m[1])*60+(m[2]?parseInt(m[2]):0);
  var closeMin=parseInt(m[3])*60+(m[4]?parseInt(m[4]):0);
  return nowMin>=openMin&&nowMin<closeMin
    ?{status:'open',text:'영업중',label:'영업 중'}
    :{status:'closed',text:'영업종료',label:'오늘 마감'};
}
</script>
<script>
// ═══ SCHEDULE RENDERING ═══

function isStayItem(item){
  if(!item.title) return false;
  return item.title.indexOf('체크인')!==-1||item.title.indexOf('정착')!==-1;
}

function renderPlaceDetail(item){
  if(isStayItem(item)) return renderStayDetailInline();
  if(item.subPlaces&&item.subPlaces.length){
    var html='';
    item.subPlaces.forEach(function(sp){html+=renderSinglePlaceCardInline(sp.name,sp.subtitle,sp.guide)});
    return html;
  }
  var g=item.guide;
  if(!g) return '';
  return renderSinglePlaceCardInline(g.placeName||item.title,g.subtitle,g);
}

function renderSinglePlaceCardInline(name,subtitle,g){
  var html='<details class="place-detail">';
  html+='<summary>';
  html+='<div class="place-detail-top">';
  html+='<span class="place-detail-name">'+esc(name)+'</span>';
  html+='<div class="option-chevron"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 18l6-6-6-6"/></svg></div>';
  html+='</div>';
  if(subtitle) html+='<div class="place-detail-sub">'+esc(subtitle)+'</div>';
  var tags=[];
  if(g.practicalInfo&&g.practicalInfo.parking) tags.push('주차 가능');
  if(g.babyTips&&g.babyTips.stroller) tags.push({text:'유모차 OK',cls:'baby'});
  if(g.babyTips&&g.babyTips.nursingRoom) tags.push({text:'수유실',cls:'baby'});
  if(tags.length){
    html+='<div class="place-detail-tags">';
    tags.forEach(function(t){
      if(typeof t==='string') html+='<span class="place-tag">'+t+'</span>';
      else html+='<span class="place-tag '+t.cls+'">'+t.text+'</span>';
    });
    html+='</div>';
  }
  html+='</summary>';
  html+='<div class="place-detail-body">';
  if(g.mustDo&&g.mustDo.length){
    html+='<div class="place-body-label">꼭 할 것</div><ul class="place-list">';
    g.mustDo.forEach(function(m){html+='<li>'+esc(m)+'</li>'});
    html+='</ul>';
  }
  if(g.babyTips&&Object.keys(g.babyTips).length){
    html+='<div class="place-body-label">아기 동반 팁</div>';
    var bt=g.babyTips;
    if(bt.stroller) html+='<div class="place-info-row"><span class="place-info-label">유모차</span>'+esc(bt.stroller)+'</div>';
    if(bt.nursingRoom) html+='<div class="place-info-row"><span class="place-info-label">수유실</span>'+esc(bt.nursingRoom)+'</div>';
    if(bt.restroom) html+='<div class="place-info-row"><span class="place-info-label">화장실</span>'+esc(bt.restroom)+'</div>';
    if(bt.restSpots&&bt.restSpots.length) html+='<div class="place-info-row"><span class="place-info-label">쉴 곳</span>'+bt.restSpots.map(esc).join(', ')+'</div>';
    if(bt.recommendedRoute) html+='<div class="place-info-row"><span class="place-info-label">추천 동선</span>'+esc(bt.recommendedRoute)+'</div>';
  }
  if(g.practicalInfo){
    html+='<div class="place-body-label">실용 정보</div>';
    var pi=g.practicalInfo;
    if(pi.address) html+='<div class="place-info-row"><span class="place-info-label">주소</span>'+esc(pi.address)+'</div>';
    if(pi.hours) html+='<div class="place-info-row"><span class="place-info-label">영업시간</span>'+esc(pi.hours)+'</div>';
    if(pi.fee) html+='<div class="place-info-row"><span class="place-info-label">입장료</span>'+esc(pi.fee)+'</div>';
    if(pi.phone) html+='<div class="place-info-row"><span class="place-info-label">전화</span>'+esc(pi.phone)+'</div>';
    if(pi.parking) html+='<div class="place-info-row"><span class="place-info-label">주차</span>'+esc(pi.parking)+'</div>';
    if(pi.timeNeeded) html+='<div class="place-info-row"><span class="place-info-label">소요시간</span>'+esc(pi.timeNeeded)+'</div>';
    if(pi.closedDays) html+='<div class="place-info-row"><span class="place-info-label">휴무</span>'+esc(pi.closedDays)+'</div>';
    if(pi.fromAccommodation) html+='<div class="place-info-row"><span class="place-info-label">숙소에서</span>'+esc(pi.fromAccommodation)+'</div>';
  }
  var mapUrl=(g.practicalInfo&&g.practicalInfo.mapUrl)||'';
  if(mapUrl) html+='<a class="option-map-link" href="'+escAttr(mapUrl)+'" target="_blank">지도에서 보기 <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg></a>';
  html+='</div></details>';
  return html;
}

function renderStayDetailInline(){
  if(typeof STAY_DATA==='undefined') return '';
  var s=STAY_DATA;
  var html='<details class="place-detail stay-detail">';
  html+='<summary><div class="place-detail-top">';
  html+='<span class="place-detail-name">'+esc(s.name)+'</span>';
  html+='<span class="place-detail-hours">체크인 '+esc(s.checkin)+'</span>';
  html+='<div class="option-chevron"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 18l6-6-6-6"/></svg></div>';
  html+='</div></summary>';
  html+='<div class="place-detail-body">';
  html+='<div class="place-info-row"><span class="place-info-label">주소</span>'+esc(s.address)+'</div>';
  html+='<div class="place-info-row"><span class="place-info-label">전화</span>'+esc(s.phone)+'</div>';
  html+='<div class="place-info-row"><span class="place-info-label">체크인/아웃</span>'+s.checkin+' / '+s.checkout+'</div>';
  html+='<div class="place-info-row"><span class="place-info-label">주차</span>'+esc(s.parking)+'</div>';
  if(s.kids&&s.kids.length){
    html+='<div class="place-body-label">키즈 시설</div><ul class="place-list">';
    s.kids.forEach(function(k){html+='<li>'+esc(k)+'</li>'});
    html+='</ul>';
  }
  if(s.amenities&&s.amenities.baby&&s.amenities.baby.length){
    html+='<div class="place-body-label">아기 용품</div>';
    html+='<div class="place-info-row">'+s.amenities.baby.map(esc).join(', ')+'</div>';
  }
  if(s.pool) html+='<div class="place-body-label">풀장</div><div class="place-info-row">'+esc(s.pool.note)+'</div>';
  if(s.mapUrl) html+='<a class="option-map-link" href="'+escAttr(s.mapUrl)+'" target="_blank">지도에서 보기 ↗</a>';
  html+='</div></details>';
  return html;
}

function renderOptionCard(opt,item){
  var showOptionDist=userLat&&!(getItemDistance(item)&&getItemDistance(item).km>=50);
  var html='<details class="card">';
  html+='<summary>';
  html+='<div class="rest__header">';
  html+='<span class="rest__name">'+esc(opt.name)+'</span>';
  html+='<div class="rest__right">';
  if(opt.rating) html+='<span class="rest__score">'+opt.rating+'</span>';
  if(opt.hours){var oc=parseOpenClosed(opt.hours);if(oc) html+='<span class="badge'+(oc.status==='closed'?' badge--closed':'')+'">'+oc.text+'</span>'}
  html+='</div></div>';
  var brief=opt.menu||opt.desc||'';
  if(brief) html+='<span class="rest__sub">'+esc(brief)+'</span>';
  if(showOptionDist&&opt.lat&&opt.lng){var km=haversineKm(userLat,userLng,opt.lat,opt.lng);html+='<span class="rest__sub" style="color:var(--text-3)">'+(km<1?km.toFixed(1):Math.round(km))+'km</span>'}
  html+='<div class="chevron">'+CHEVRON_SVG+'<span>상세보기</span></div>';
  html+='</summary>';
  html+='<div class="card__body">';
  html+='<div class="hr"></div>';
  if(opt.menuDetail&&opt.menuDetail.length){
    html+='<div>';
    opt.menuDetail.forEach(function(m){html+='<div class="menu-row"><span class="menu-row__name">'+esc(m.item)+'</span>';if(m.price) html+='<span class="menu-row__price">'+Number(m.price).toLocaleString()+'원</span>';html+='</div>'});
    html+='</div><div class="hr"></div>';
  }
  html+='<div>';
  if(opt.priceRange) html+='<div class="info-row"><span class="info-row__label">가격대</span><span class="info-row__value">'+esc(opt.priceRange)+'</span></div>';
  if(opt.hours) html+='<div class="info-row"><span class="info-row__label">영업시간</span><span class="info-row__value">'+esc(opt.hours)+'</span></div>';
  if(opt.loc) html+='<div class="info-row"><span class="info-row__label">위치</span><span class="info-row__value">'+esc(opt.loc)+'</span></div>';
  html+='</div>';
  var tags=buildBadges(opt);
  if(tags) html+='<div class="tags">'+tags+'</div>';
  if(opt.mapUrl) html+='<a class="map-link" href="'+escAttr(opt.mapUrl)+'" target="_blank">'+MAP_SVG+' 지도에서 보기</a>';
  html+='</div></details>';
  return html;
}

function renderSimpleOption(opt,item){
  var html='<div class="card" style="gap:12px">';
  html+='<div class="alt__header">';
  html+='<span class="alt__title">'+esc(opt.name)+'</span>';
  var simpleBrief=opt.menu||opt.desc||'';
  if(simpleBrief) html+='<span class="alt__dash">—</span><span class="alt__desc">'+esc(simpleBrief)+'</span>';
  html+='</div>';
  var tags=buildBadges(opt);
  if(tags) html+='<div class="tags">'+tags+'</div>';
  html+='</div>';
  return html;
}

// ═══ EDITORIAL HELPERS ═══
var MAP_SVG='<svg viewBox="0 0 24 24" width="14" height="14" style="stroke:currentColor;fill:none;stroke-width:2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>';
var CHEVRON_SVG='<svg viewBox="0 0 24 24" width="14" height="14" style="stroke:currentColor;fill:none;stroke-width:2"><path d="M9 18l6-6-6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>';

function getItemVisualType(item){
  if(!item.cat) return 'activity';
  if(item.cat==='meal'||item.cat==='cafe') return 'meal';
  if(item.cat==='activity') return 'activity';
  if(item.cat==='move') return 'move';
  if(item.cat==='stay') return 'stay';
  if(isStayItem(item)) return 'stay';
  return 'activity';
}

function getCatLabel(item){
  var map={meal:'식사',cafe:'카페',activity:'관광',move:'이동',stay:'숙소'};
  return map[item.cat]||'';
}

function renderItemCard(item){
  var vType=getItemVisualType(item);
  var catLabel=getCatLabel(item);
  var isVisited=item.visited===true;
  var isSkipped=item.status==='skipped';
  var isDone=item.status==='done';

  var html='<div class="section">';

  // ctx header
  html+='<div class="ctx"><div class="ctx__left">';
  html+='<span class="ctx__dot ctx__dot--'+vType+'"></span>';
  html+='<span class="ctx__label">'+(item.time||'')+'</span>';
  html+='</div><div class="ctx__right">';
  if(isDone||isVisited) html+='<span class="ctx__status ctx__status--done">완료</span>';
  else if(isSkipped) html+='<span class="ctx__status">건너뜀</span>';
  html+='<span class="ctx__cat ctx__cat--'+vType+'">'+esc(catLabel)+'</span>';
  html+='</div></div>';

  // sec-title
  html+='<div class="sec-title">';
  html+='<h2 class="sec-title__text">'+(isSkipped?'<s>':'')+esc(item.title)+(isSkipped?'</s>':'');
  if(isVisited&&item.visitedOption) html+=' <span style="font-family:var(--mono);font-size:14px;font-weight:400;color:var(--green)">— '+esc(item.visitedOption)+'</span>';
  html+='</h2>';
  if(item.review) html+='<div class="sec-title__sub" style="font-style:italic">"'+esc(item.review)+'"</div>';
  html+='</div>';

  // place detail for activity items
  if(item.cat==='activity') html+=renderPlaceDetail(item);

  // distance info
  if(userLat&&item.options&&item.options.length>0){
    var distInfo=getItemDistance(item);
    if(distInfo&&distInfo.km<50){
      var fmt=formatDistance(distInfo.km);
      html+='<div style="background:var(--surface);padding:8px 24px;border-bottom:1px solid var(--border);font-family:var(--mono);font-size:12px;color:'+(fmt.cls==='nearby'?'var(--green)':'var(--text-2)')+'">'+fmt.text+'</div>';
    }
  }

  // options (restaurants etc)
  if(item.options&&item.options.length>0){
    item.options.forEach(function(opt){
      var hasRichData=opt.rating||opt.menuDetail||opt.hours||opt.mapUrl;
      if(hasRichData) html+=renderOptionCard(opt,item);
      else html+=renderSimpleOption(opt,item);
    });
  }

  // note
  if(item.note){
    html+='<div style="background:var(--surface);padding:12px 24px;border:1px solid var(--border);font-family:var(--mono);font-size:12px;color:var(--text-2)">';
    html+='<span style="font-weight:500;color:var(--text-3)">메모</span> '+esc(item.note)+'</div>';
  }

  html+='</div>';
  return html;
}

function renderDayContent(){
  patchGuideData(travelData.days);
  var area=document.getElementById('contentArea');
  var day=travelData.days[activeDay];
  if(!day){area.innerHTML='<div class="loading">데이터 없음</div>';return}

  var totalItems=day.items.length;
  var doneItems=day.items.filter(function(i){return i.status==='done'||i.status==='skipped'}).length;
  var progress=totalItems>0?(doneItems/totalItems*100):0;

  var html='';
  // day hero
  html+='<div class="day-hero section">';
  html+='<div class="day-hero__num">Day '+day.dayNum+'</div>';
  html+='<h1 class="day-hero__title">'+esc(day.title)+'</h1>';
  html+='<div class="day-hero__date">'+esc(day.date)+'</div>';
  html+='<div class="day-hero__progress">';
  html+='<div class="day-hero__bar"><div class="day-hero__bar-fill" style="width:'+progress+'%"></div></div>';
  html+='<span class="day-hero__pct">'+doneItems+'/'+totalItems+'</span>';
  html+='</div></div>';

  html+='<div class="section-gap"></div>';

  day.items.forEach(function(item,idx){
    html+=renderItemCard(item);
    if(idx<day.items.length-1) html+='<div class="section-gap"></div>';
  });

  area.innerHTML=html;
}
</script>
<script>
// ═══ PLACES TAB ═══
function renderPlaces(days){
  var html='';
  html+='<div class="day-hero section">';
  html+='<div class="day-hero__num">Places</div>';
  html+='<h1 class="day-hero__title">장소 가이드</h1>';
  html+='<div class="day-hero__date">주요 관광지 · 아이 동반 팁</div>';
  html+='</div>';

  var seen={};var places=[];
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.cat==='activity'&&item.guide&&!seen[item.id]){seen[item.id]=true;places.push(item)}
    });
  });

  var extraPlaces=[
    {title:'홈플러스 경주점',id:'extra_homeplus',cat:'activity',guide:{subtitle:'경주 유일의 대형 할인점 · 2024 메가푸드마켓 리뉴얼',mustDo:['BBQ 식재료·간식·음료 장보기','아기 간식·이유식 재료 확보'],babyTips:{stroller:'단층 매장이라 유모차 이동 편리',nursingRoom:'매장 내 수유실 (전화확인: 054-770-8000)',restSpots:['수퍼윙스 키즈카페 (1층)']},practicalInfo:{hours:'09:00~22:00',parking:'1층 고객주차장 + 2층 옥상주차장 (유료, 구매시 무료)',phone:'054-770-8000',closedDays:'매월 둘째·넷째 일요일 (\u26A0\uFE0F 2/22 휴무!)',address:'경상북도 경주시 공단로 97',fromAccommodation:'까사멜로우에서 차량 약 15분',mapUrl:'https://map.naver.com/p/search/홈플러스%20경주점'}}},
    {title:'사랑의 소아과의원',id:'extra_clinic',cat:'activity',guide:{subtitle:'아이 아플 때 대비 — 소아청소년과 전문의',mustDo:['방문 전 반드시 전화 확인 (임시 휴진 가능)','야간/공휴일: E-GEN 앱에서 당일 진료 병원 검색'],babyTips:{},practicalInfo:{address:'경상북도 경주시 황성로 59, 2층',phone:'054-773-7740',hours:'평일 09:00~18:00 (추정), 토 09:00~13:00',closedDays:'일요일·공휴일 휴진',mapUrl:'https://naver.me/GJrFT2S7'}}}
  ];
  extraPlaces.forEach(function(ep){if(!seen[ep.id]){seen[ep.id]=true;places.push(ep)}});

  var cardIndex=0;
  places.forEach(function(item){
    var g=item.guide;
    if(item.subPlaces&&item.subPlaces.length){
      item.subPlaces.forEach(function(sp){html+=renderGuidePlace(sp,cardIndex++,days)});
    } else {
      html+=renderGuidePlace({name:g.placeName||item.title,subtitle:g.subtitle,guide:g,babyTips:g.babyTips},cardIndex++,days);
    }
  });
  return html;
}

function isPlaceVisited(placeName,days){
  var visited=false;
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.visited&&item.cat==='activity'){
        if(item.title===placeName) visited=true;
        if(item.subPlaces){
          item.subPlaces.forEach(function(sp){if(sp.name===placeName) visited=true});
        }
      }
    });
  });
  return visited;
}

function getPlaceReview(placeName,days){
  var review='';
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.visited&&item.review&&item.cat==='activity'){
        if(item.title===placeName) review=item.review;
      }
    });
  });
  return review;
}

function renderGuidePlace(sp,idx,days){
  var g=sp.guide;if(!g) return '';
  var visited=isPlaceVisited(sp.name,days);
  var review=getPlaceReview(sp.name,days);
  var html='<details class="card fade-up'+(visited?' visited':'')+'" data-section="places"';
  html+=' style="animation-delay:'+(idx*0.05)+'s">';
  html+='<summary>';
  html+='<div class="card-top">';
  html+='<span class="card-name">'+esc(sp.name)+'</span>';
  if(visited) html+='<span class="visit-badge">&#10003;</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div>';
  if(sp.subtitle) html+='<div class="card-sub">'+esc(sp.subtitle)+'</div>';
  var placeDistKm=getPlaceDistKm(sp.name);
  if(placeDistKm!==null&&placeDistKm<100){
    html+='<div class="rest-status-row"><span class="rest-dist">'+(placeDistKm<1?placeDistKm.toFixed(1):Math.round(placeDistKm))+'km</span></div>';
  }
  if(review) html+='<div class="review-text">"'+esc(review)+'"</div>';
  html+='</summary>';
  html+='<div class="card-body">';
  if(g.mustDo&&g.mustDo.length>0){
    html+='<div class="place-section"><div class="place-section-label">Must-Do</div><ul class="place-list">';
    g.mustDo.forEach(function(m){html+='<li>'+esc(m)+'</li>'});
    html+='</ul></div>';
  }
  if(g.babyTips){
    var bt=g.babyTips;
    var hasBt=bt.stroller||bt.nursingRoom||bt.restroom||(bt.restSpots&&bt.restSpots.length)||bt.recommendedRoute;
    if(hasBt){
      html+='<div class="place-section"><div class="place-section-label">아이 동반 팁</div>';
      if(bt.stroller){html+='<div class="baby-tip"><div class="baby-tip-label">유모차</div><div class="baby-tip-text">'+esc(bt.stroller)+'</div></div>'}
      if(bt.nursingRoom){html+='<div class="baby-tip"><div class="baby-tip-label">수유실</div><div class="baby-tip-text">'+esc(bt.nursingRoom)+'</div></div>'}
      if(bt.restroom){html+='<div class="baby-tip"><div class="baby-tip-label">화장실</div><div class="baby-tip-text">'+esc(bt.restroom)+'</div></div>'}
      if(bt.restSpots&&bt.restSpots.length){html+='<div class="baby-tip"><div class="baby-tip-label">쉴 곳</div><div class="baby-tip-text">'+bt.restSpots.map(esc).join(', ')+'</div></div>'}
      if(bt.recommendedRoute){html+='<div class="baby-tip"><div class="baby-tip-label">추천 동선</div><div class="baby-tip-text">'+esc(bt.recommendedRoute)+'</div></div>'}
      html+='</div>';
    }
  }
  if(g.practicalInfo){
    html+='<div class="place-section"><div class="place-section-label">실용 정보</div><div class="info-grid">';
    var pi=g.practicalInfo;
    if(pi.address) html+='<div class="info-label">주소</div><div class="info-value">'+esc(pi.address)+'</div>';
    if(pi.hours) html+='<div class="info-label">운영</div><div class="info-value">'+esc(pi.hours)+'</div>';
    if(pi.fee) html+='<div class="info-label">요금</div><div class="info-value">'+esc(pi.fee)+'</div>';
    if(pi.phone) html+='<div class="info-label">전화</div><div class="info-value">'+esc(pi.phone)+'</div>';
    if(pi.parking) html+='<div class="info-label">주차</div><div class="info-value">'+esc(pi.parking)+'</div>';
    if(pi.timeNeeded) html+='<div class="info-label">소요</div><div class="info-value">'+esc(pi.timeNeeded)+'</div>';
    if(pi.closedDays) html+='<div class="info-label">휴무</div><div class="info-value">'+esc(pi.closedDays)+'</div>';
    if(pi.fromAccommodation) html+='<div class="info-label">숙소에서</div><div class="info-value">'+esc(pi.fromAccommodation)+'</div>';
    html+='</div>';
    if(pi.mapUrl) html+='<a href="'+escAttr(pi.mapUrl)+'" target="_blank" class="rest-map-link"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1118 0z"/><circle cx="12" cy="10" r="3"/></svg>지도 보기</a>';
    html+='</div>';
  }
  html+='</div></details>';
  return html;
}

// ═══ RESTAURANTS TAB ═══
function extractRestaurants(days){
  var map={};
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.cat!=='meal'&&item.cat!=='cafe') return;
      if(!item.options) return;
      item.options.forEach(function(opt){
        var key=opt.name;if(!key) return;
        if(opt.loc==='숙소') return;
        if(!map[key]){
          map[key]={
            name:opt.name,menu:opt.menu||opt.desc||'',hours:opt.hours||'',
            loc:opt.loc||'',lat:opt.lat||null,lng:opt.lng||null,
            dad:opt.dad||'',dadNote:opt.dadNote||'',hiro:opt.hiro||'',hiroNote:opt.hiroNote||'',
            rating:opt.rating||null,ratingSource:opt.ratingSource||'',
            priceRange:opt.priceRange||'',menuDetail:opt.menuDetail||null,
            mapUrl:opt.mapUrl||'',category:opt.category||'',cat:item.cat,
            type:item.cat==='cafe'?'cafe':'meal',
            meals:[],distKm:null
          };
        }
        map[key].meals.push('Day '+day.dayNum+' '+(item.time||''));
        if(!map[key].hours&&opt.hours) map[key].hours=opt.hours;
        if(!map[key].lat&&opt.lat){map[key].lat=opt.lat;map[key].lng=opt.lng}
        if(!map[key].rating&&opt.rating) map[key].rating=opt.rating;
        if(opt.dad==='good') map[key].dad='good';
        if(opt.hiro==='good') map[key].hiro='good';
      });
    });
  });
  return Object.values(map);
}

function sortRestaurants(list){
  if(userLat){
    list.forEach(function(r){r.distKm=(r.lat&&r.lng)?haversineKm(userLat,userLng,r.lat,r.lng):null});
  }
  if(restSortMode==='distance'&&userLat){
    list.sort(function(a,b){return (a.distKm||9999)-(b.distKm||9999)});
  } else {
    list.sort(function(a,b){var ra=a.rating||0,rb=b.rating||0;if(rb!==ra) return rb-ra;return a.name.localeCompare(b.name)});
  }
  return list;
}

function isRestVisited(name,days){
  var visited=false;
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.visited&&item.visitedOption===name) visited=true;
    });
  });
  return visited;
}

function getRestReview(name,days){
  var review='';
  days.forEach(function(day){
    day.items.forEach(function(item){
      if(item.visited&&item.visitedOption===name&&item.review) review=item.review;
    });
  });
  return review;
}

function buildBadges(opt){
  var b='';
  if(opt.dad==='good') b+='<span class="tag">아빠 OK</span>';
  if(opt.dad==='caution') b+='<span class="tag">아빠 주의'+(opt.dadNote?' · '+esc(opt.dadNote):'')+'</span>';
  if(opt.hiro==='good') b+='<span class="tag">히로 OK</span>';
  if(opt.hiro==='caution') b+='<span class="tag">히로 주의'+(opt.hiroNote?' · '+esc(opt.hiroNote):'')+'</span>';
  return b;
}

function renderRestaurants(days){
  allRestaurants=extractRestaurants(days);
  allRestaurants=sortRestaurants(allRestaurants);
  var html='';
  html+='<div class="day-hero section">';
  html+='<div class="day-hero__num">Restaurants</div>';
  html+='<h1 class="day-hero__title">식당 · 카페 가이드</h1>';
  html+='<div class="day-hero__date">'+allRestaurants.length+'곳 · 메뉴 · 알레르기 정보</div>';
  html+='</div>';
  html+='<div id="restList">'+renderRestCards(allRestaurants,days)+'</div>';
  return html;
}

function renderRestCards(list,days){
  if(!days) days=travelData.days;
  var html='';
  list.forEach(function(r,i){
    var oc=parseOpenClosed(r.hours);
    var visited=isRestVisited(r.name,days);
    var review=getRestReview(r.name,days);
    html+='<details class="card fade-up'+(visited?' visited':'')+'" data-section="restaurants"';
    html+=' data-type="'+escAttr(r.type||r.cat||'meal')+'"';
    html+=' style="animation-delay:'+(i*0.04)+'s">';
    html+='<summary>';
    html+='<div class="card-top">';
    html+='<span class="card-name">'+esc(r.name)+'</span>';
    if(r.rating) html+='<span class="rest-rating">'+r.rating.toFixed(1)+'</span>';
    if(visited) html+='<span class="visit-badge">&#10003;</span>';
    html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
    html+='</div>';
    html+='<div class="rest-meta">';
    if(r.menu) html+='<span class="rest-menu-brief">'+esc(r.menu)+'</span>';
    html+='</div>';
    html+='<div class="rest-status-row">';
    if(oc&&oc.status!=='unknown') html+='<span class="open-tag '+oc.status+'">'+(oc.label||oc.text)+'</span>';
    if(r.distKm!==null&&r.distKm<100) html+='<span class="rest-dist">'+(r.distKm<1?r.distKm.toFixed(1):Math.round(r.distKm))+'km</span>';
    html+='</div>';
    if(review) html+='<div class="review-text">"'+esc(review)+'"</div>';
    html+='</summary>';
    html+='<div class="card-body">';
    if(r.menuDetail&&r.menuDetail.length>0){r.menuDetail.forEach(function(m){html+='<div class="rest-info">'+esc(m.item);if(m.price) html+=' <span style="color:var(--text-2)">'+formatPrice(m.price)+'</span>';html+='</div>'})}
    else if(r.menu){html+='<div class="rest-info"><span class="rest-info-label">메뉴</span>'+esc(r.menu)+'</div>'}
    if(r.priceRange) html+='<div class="rest-info"><span class="rest-info-label">가격대</span>'+esc(r.priceRange)+'</div>';
    if(r.hours) html+='<div class="rest-info"><span class="rest-info-label">영업시간</span>'+esc(r.hours)+'</div>';
    if(r.loc) html+='<div class="rest-info"><span class="rest-info-label">위치</span>'+esc(r.loc)+'</div>';
    var badges=buildBadges(r);if(badges) html+='<div class="badges">'+badges+'</div>';
    if(r.meals.length>0){var um=[];r.meals.forEach(function(m){if(um.indexOf(m)===-1) um.push(m)});html+='<div class="rest-meals">'+um.join(' / ')+'</div>'}
    if(r.mapUrl){html+='<a class="rest-map-link" href="'+escAttr(r.mapUrl)+'" target="_blank" rel="noopener">지도에서 보기<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M7 17L17 7M17 7H7M17 7v10"/></svg></a>'}
    html+='</div></details>';
  });
  return html;
}
</script>
<script>
// ═══ STAY TAB ═══
function renderStay(){
  var s=STAY_DATA;
  var html='';
  html+='<div class="day-hero section">';
  html+='<div class="day-hero__num">Stay</div>';
  html+='<h1 class="day-hero__title">숙소 안내</h1>';
  html+='<div class="day-hero__date">'+esc(s.name)+' · 5박</div>';
  html+='</div>';

  html+='<details class="card fade-up" open>';
  html+='<summary><div class="card-top"><span class="card-name">'+esc(s.name)+'</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div><div class="card-sub">'+esc(s.desc)+'</div></summary>';
  html+='<div class="card-body"><div class="info-grid">';
  html+='<span class="info-label">주소</span><span class="info-value">'+esc(s.address)+'</span>';
  html+='<span class="info-label">체크인</span><span class="info-value">'+esc(s.checkin)+'</span>';
  html+='<span class="info-label">체크아웃</span><span class="info-value">'+esc(s.checkout)+'</span>';
  html+='<span class="info-label">주차</span><span class="info-value">'+esc(s.parking)+'</span>';
  html+='<span class="info-label">연락처</span><span class="info-value">'+esc(s.phone)+'</span>';
  html+='<span class="info-label">인스타</span><span class="info-value">'+esc(s.instagram)+'</span>';
  html+='</div>';
  html+='<div class="link-row">';
  html+='<a href="'+escAttr(s.mapUrl)+'" target="_blank" class="link-btn link-btn-outline">지도 보기</a>';
  html+='<a href="'+escAttr(s.stayfolioUrl)+'" target="_blank" class="link-btn link-btn-solid">스테이폴리오</a>';
  html+='</div></div></details>';

  html+='<details class="card fade-up" style="animation-delay:0.06s">';
  html+='<summary><div class="card-top"><span class="card-name">객실 정보</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div><div class="card-sub">전 객실 복층 · 키즈룸 · 온수풀</div></summary>';
  html+='<div class="card-body"><div class="stay-room-grid">';
  s.rooms.forEach(function(r){
    html+='<div class="stay-room-chip"><div class="stay-room-label">'+esc(r.name)+'</div>';
    html+='<div class="stay-room-detail">'+esc(r.type)+'<br>'+esc(r.people)+'<br>'+esc(r.bed)+'<br>욕실 '+esc(r.bath)+'</div></div>';
  });
  html+='</div><div class="info-grid">';
  html+='<span class="info-label">1층</span><span class="info-value">거실 · 주방 · 키즈룸 · 세탁실 · BBQ · 풀장</span>';
  html+='<span class="info-label">2층</span><span class="info-value">침실 · 테라스 · 화장실/샤워실</span>';
  html+='<span class="info-label">초과</span><span class="info-value">1인 1박 30,000원 (24개월 미만 무료)</span>';
  html+='</div></div></details>';

  html+='<details class="card fade-up" style="animation-delay:0.12s">';
  html+='<summary><div class="card-top"><span class="card-name">키즈 시설</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div><div class="card-sub">실내 키즈룸 + 야외 놀이터</div></summary>';
  html+='<div class="card-body"><ul class="place-list">';
  s.kids.forEach(function(k){html+='<li>'+esc(k)+'</li>'});
  html+='</ul><div class="highlight-box" style="margin-top:12px"><div class="highlight-label">Baby Amenity</div>';
  html+='<div class="highlight-text">'+s.amenities.baby.map(esc).join(' · ')+'</div></div></div></details>';

  html+='<details class="card fade-up" style="animation-delay:0.18s">';
  html+='<summary><div class="card-top"><span class="card-name">수영장 · BBQ</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div><div class="card-sub">온수 풀 · 전기그릴 무료</div></summary>';
  html+='<div class="card-body">';
  html+='<div class="place-section"><div class="place-section-label">Pool</div><div class="info-grid">';
  html+='<span class="info-label">수심</span><span class="info-value">'+esc(s.pool.depth)+'</span>';
  html+='<span class="info-label">이용</span><span class="info-value">'+esc(s.pool.note)+'</span>';
  html+='</div></div>';
  html+='<div class="place-section"><div class="place-section-label">BBQ</div><div class="info-grid">';
  html+='<span class="info-label">기본</span><span class="info-value">'+esc(s.bbq.note)+'</span>';
  html+='<span class="info-label">추가</span><span class="info-value">'+esc(s.bbq.extra)+'</span>';
  html+='</div></div></div></details>';

  html+='<details class="card fade-up" style="animation-delay:0.24s">';
  html+='<summary><div class="card-top"><span class="card-name">비품 · 어메니티</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div><div class="card-sub">주방 · 욕실 · 일반</div></summary>';
  html+='<div class="card-body">';
  [{l:'Kitchen',items:s.amenities.kitchen},{l:'Bath',items:s.amenities.bath},{l:'General',items:s.amenities.general}].forEach(function(g){
    html+='<div class="place-section"><div class="place-section-label">'+g.l+'</div><div class="amenity-tags">';
    g.items.forEach(function(item){html+='<span class="amenity-tag">'+esc(item)+'</span>'});
    html+='</div></div>';
  });
  html+='</div></details>';

  html+='<details class="card fade-up" style="animation-delay:0.3s">';
  html+='<summary><div class="card-top"><span class="card-name">이용 규칙</span>';
  html+='<div class="card-chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M9 5l7 7-7 7"/></svg></div>';
  html+='</div><div class="card-sub">숙소 이용 시 참고사항</div></summary>';
  html+='<div class="card-body"><ul class="place-list">';
  s.rules.forEach(function(r){html+='<li>'+esc(r)+'</li>'});
  html+='</ul></div></details>';

  html+='<div class="footer"><div class="footer-note">식당 별점·가격은 참고용이며 현장과 다를 수 있습니다</div></div>';
  return html;
}

// ═══ TAB NAVIGATION ═══
function switchTab(tabName){
  activeTab=tabName;
  document.querySelectorAll('.section-nav-btn').forEach(function(btn){
    btn.classList.toggle('active',btn.getAttribute('data-tab')===tabName);
  });
  document.getElementById('dayTabs').style.display=tabName==='schedule'?'':'none';
  document.getElementById('restSubTabsWrap').style.display=tabName==='restaurants'?'':'none';
  renderContent(tabName);
}

function renderContent(tabName){
  if(!travelData) return;
  patchGuideData(travelData.days);
  var area=document.getElementById('contentArea');
  switch(tabName){
    case 'schedule':renderDayTabs();renderDayContent();break;
    case 'places':area.innerHTML=renderPlaces(travelData.days);break;
    case 'restaurants':renderRestSubTabs();area.innerHTML=renderRestaurants(travelData.days);applyRestFilters();break;
    case 'stay':area.innerHTML=renderStay();break;
  }
}

function renderDayTabs(){
  var tabs=document.getElementById('dayTabs');
  var days=travelData.days;
  tabs.innerHTML='';
  days.forEach(function(day,idx){
    var tab=document.createElement('div');
    tab.className='day-tab'+(idx===activeDay?' active':'');
    tab.innerHTML=day.dayNum+'일차'+'<span class="tab-date">'+formatTabDate(day.date)+'</span>';
    tab.onclick=function(){activeDay=idx;renderDayTabs();renderDayContent()};
    tabs.appendChild(tab);
  });
  var activeTabEl=tabs.querySelector('.active');
  if(activeTabEl) activeTabEl.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
}

function renderRestSubTabs(){
  var mealCount=0,cafeCount=0;
  allRestaurants=extractRestaurants(travelData.days);
  allRestaurants.forEach(function(r){if(r.type==='cafe') cafeCount++;else mealCount++});

  var subWrap=document.getElementById('restSubTabs');
  subWrap.innerHTML='';
  subWrap.innerHTML+='<button class="rest-sub-tab'+(restTypeFilter==='all'?' active':'')+'" data-type="all" onclick="filterRestType(\'all\')">전체 ('+allRestaurants.length+')</button>';
  subWrap.innerHTML+='<button class="rest-sub-tab'+(restTypeFilter==='meal'?' active':'')+'" data-type="meal" onclick="filterRestType(\'meal\')">식당 ('+mealCount+')</button>';
  subWrap.innerHTML+='<button class="rest-sub-tab'+(restTypeFilter==='cafe'?' active':'')+'" data-type="cafe" onclick="filterRestType(\'cafe\')">카페 ('+cafeCount+')</button>';

  var sortWrap=document.getElementById('sortBar');
  sortWrap.innerHTML='';
  sortWrap.innerHTML+='<button class="sort-btn'+(restSortMode==='rating'?' active':'')+'" onclick="changeRestSort(\'rating\')">별점순</button>';
  sortWrap.innerHTML+='<button class="sort-btn'+(restSortMode==='distance'?' active':'')+'" onclick="changeRestSort(\'distance\')">'+(userLat?'거리순':'거리순 (위치 필요)')+'</button>';
}

function filterRestType(type){
  restTypeFilter=type;
  document.querySelectorAll('.rest-sub-tab').forEach(function(t){t.classList.toggle('active',t.getAttribute('data-type')===type)});
  applyRestFilters();
}

function changeRestSort(mode){
  if(mode==='distance'&&!userLat){requestRestLocation();return}
  restSortMode=mode;
  allRestaurants=sortRestaurants(allRestaurants);
  if(activeTab==='restaurants') renderContent('restaurants');
}

function requestRestLocation(){
  if(!navigator.geolocation) return;
  navigator.geolocation.getCurrentPosition(function(pos){
    userLat=pos.coords.latitude;userLng=pos.coords.longitude;
    restSortMode='distance';
    if(activeTab==='restaurants') renderContent('restaurants');
  },function(){},{enableHighAccuracy:false,timeout:10000,maximumAge:300000});
}

function applyRestFilters(){
  document.querySelectorAll('.card[data-section="restaurants"]').forEach(function(card){
    if(restTypeFilter!=='all'&&card.getAttribute('data-type')!==restTypeFilter) card.style.display='none';
    else card.style.display='';
  });
}
</script>
<script>
// ═══ APP INIT ═══
(function init(){
  fetchData();
})();

async function fetchData(){
  try{
    var res=await fetch('/api/data');
    if(!res.ok) throw new Error('HTTP '+res.status);
    var json=await res.json();
    travelData=json.record;
    hideError();
    render();
  } catch(e){
    showError('연결 끊김. 다시 시도 중...');
    console.error('fetch error:',e);
  }
}

function render(){
  if(!travelData) return;
  updateHeader();
  renderContent(activeTab);
}

function updateHeader(){
  var meta=travelData.meta;
  if(meta&&meta.lastUpdated){
    var d=new Date(meta.lastUpdated);
    document.getElementById('updateTime').textContent='마지막 업데이트: '+formatDateTime(d);
  }
  var urlParams=new URLSearchParams(location.search);
  var dayParam=urlParams.get('day');
  if(dayParam&&!window._dayParamApplied){
    var d2=parseInt(dayParam);
    // day param에서 dayNum으로 매칭 (dayNum:0 = 출발전)
    for(var di=0;di<travelData.days.length;di++){
      if(travelData.days[di].dayNum===d2){activeDay=di;window._dayParamApplied=true;break}
    }
  }
  var tabParam=urlParams.get('tab');
  if(tabParam&&!window._tabParamApplied){
    if(['schedule','places','restaurants','stay'].indexOf(tabParam)!==-1){
      activeTab=tabParam;window._tabParamApplied=true;
      document.querySelectorAll('.section-nav-btn').forEach(function(btn){
        btn.classList.toggle('active',btn.getAttribute('data-tab')===tabParam);
      });
    }
  }

  var now=new Date();
  var tripStart=new Date('2026-02-19T00:00:00+09:00');
  var tripEnd=new Date('2026-02-24T23:59:59+09:00');
  var status='2026.02.19 — 02.24';
  if(now<tripStart){
    var diff=Math.ceil((tripStart-now)/86400000);
    status='D-'+diff+' / 2026.02.19 — 02.24';
  } else if(now>tripEnd){
    status='여행 완료';
  } else {
    var dayNum=Math.floor((now-tripStart)/86400000)+1;
    status=dayNum+'일차 진행 중';
    // dayNum으로 해당 탭 인덱스 찾기 (dayNum:0 출발전 탭 때문)
    if(activeDay===0&&!dayParam){
      for(var ai=0;ai<travelData.days.length;ai++){
        if(travelData.days[ai].dayNum===dayNum){activeDay=ai;break}
      }
    }
  }
  document.getElementById('tripStatus').textContent=status;
}

// ═══ LOCATION ═══
function initLocationBanner(){
  if(location.protocol!=='https:'&&location.hostname!=='localhost') return;
  if(!navigator.geolocation) return;
  if(localStorage.getItem('gj_location_dismissed')==='true') return;
  setTimeout(function(){document.getElementById('locationBanner').style.display=''},1000);
}

function requestLocation(){
  if(!navigator.geolocation){showToast('이 브라우저에서 위치를 사용할 수 없습니다');return}
  navigator.geolocation.getCurrentPosition(
    function(pos){
      userLat=pos.coords.latitude;userLng=pos.coords.longitude;locationTimestamp=Date.now();
      document.getElementById('locationBanner').style.display='none';
      document.getElementById('refreshBtn').classList.add('visible');
      if(pos.coords.accuracy>500&&!gpsWarningShown){gpsWarningShown=true;showToast('위치가 정확하지 않을 수 있습니다')}
      if(travelData) renderContent(activeTab);
      showToast('위치 업데이트됨');
    },
    function(err){
      if(err.code===err.PERMISSION_DENIED) document.getElementById('locationBanner').style.display='none';
      else showToast('위치를 가져올 수 없습니다');
    },
    GEO_OPTIONS
  );
}

function dismissLocationBanner(){
  localStorage.setItem('gj_location_dismissed','true');
  document.getElementById('locationBanner').style.display='none';
}

document.addEventListener('visibilitychange',function(){
  if(document.visibilityState!=='visible') return;
  if(!userLat) return;
  if(Date.now()-locationTimestamp>1800000) requestLocation();
});

function applyTestLocation(){
  var params=new URLSearchParams(location.search);
  if(params.get('testloc')!=='1') return false;
  userLat=35.8579382;userLng=129.262038;locationTimestamp=Date.now();
  document.getElementById('locationBanner').style.display='none';
  document.getElementById('refreshBtn').classList.add('visible');
  var indicator=document.createElement('div');
  indicator.className='update-time';indicator.style.color='var(--red)';
  indicator.textContent='테스트 위치: 까사멜로우 (숙소)';
  document.querySelector('.app-header').appendChild(indicator);
  if(travelData) renderContent(activeTab);
  return true;
}

document.addEventListener('DOMContentLoaded',function(){
  if(!applyTestLocation()) initLocationBanner();
});

</script>

</body>
</html>
