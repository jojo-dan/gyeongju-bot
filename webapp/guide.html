<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>경주 가족여행 가이드</title>
<meta property="og:title" content="경주 가족여행 가이드">
<meta property="og:description" content="2026.02.19~24 · 6일간의 식당·관광지 완벽 가이드">
<meta property="og:image" content="https://gyeongju-trip.vercel.app/og-image.png">
<meta property="og:url" content="https://gyeongju-trip.vercel.app/guide">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #E5E5E5;
  --housing: #FFFFFF;
  --display: #2A2A2A;
  --display-text: #FFFFFF;
  --display-dim: rgba(255,255,255,0.65);
  --accent: #E85D2A;
  --text: #1A1A1A;
  --text-mid: #555;
  --text-light: #666;
  --border: #D5D5D5;
  --item-bg: #F5F3F0;
  --item-text: #1A1A1A;
  --item-text-mid: #444;
  --item-text-dim: #666;
  --serif: 'Playfair Display', Georgia, 'Noto Serif KR', serif;
  --mono: 'IBM Plex Mono', 'SF Mono', monospace;
  --system: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', sans-serif;
  --radius-device: 16px;
  --radius-display: 10px;
  --radius-btn: 8px;
  --shadow-device: 0 2px 24px rgba(0,0,0,0.08), 0 0 0 1px rgba(0,0,0,0.03);
  --shadow-btn: 0 1px 3px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.8);
}

body {
  font-family: var(--system);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  -webkit-text-size-adjust: 100%;
}

/* ═══ HEADER ═══ */
.header {
  padding: 32px 20px 20px;
  text-align: center;
}
.header h1 {
  font-family: var(--serif);
  font-size: 28px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--text);
  margin-bottom: 4px;
}
.header .sub-info {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-mid);
  letter-spacing: 0.5px;
}
.header .sub-detail {
  font-family: var(--system);
  font-size: 13px;
  color: var(--text-light);
  margin-top: 4px;
}
.daily-link {
  display: inline-block;
  margin-top: 10px;
  font-family: var(--system);
  font-size: 13px;
  font-weight: 600;
  color: var(--text-mid);
  text-decoration: none;
  border: 1px solid var(--border);
  border-radius: var(--radius-btn);
  padding: 6px 14px;
  background: var(--housing);
  transition: opacity 0.15s;
}
.daily-link:active { opacity: 0.7; }

/* ═══ CONTAINER ═══ */
.container {
  max-width: 420px;
  margin: 0 auto;
  padding: 0 16px 32px;
}

/* ═══ SECTION NAV (Sticky) ═══ */
.section-nav {
  display: flex;
  gap: 0;
  max-width: 420px;
  margin: 0 auto 16px;
  padding: 0 16px;
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg);
  padding-top: 8px;
  padding-bottom: 8px;
}
.section-nav-btn {
  flex: 1 1 0;
  padding: 10px 0;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 600;
  color: var(--text-mid);
  background: var(--housing);
  border: 1px solid var(--border);
  cursor: pointer;
  text-align: center;
  min-height: 40px;
  transition: all 0.15s ease;
  line-height: 1.3;
}
.section-nav-btn:first-child { border-radius: var(--radius-btn) 0 0 var(--radius-btn); }
.section-nav-btn:last-child { border-radius: 0 var(--radius-btn) var(--radius-btn) 0; }
.section-nav-btn:not(:first-child) { border-left: none; }
.section-nav-btn.active {
  background: var(--text);
  color: #fff;
  border-color: var(--text);
}

/* ═══ SECTION HEADER (Device Display) ═══ */
.section-device {
  background: var(--housing);
  border-radius: var(--radius-device);
  box-shadow: var(--shadow-device);
  margin-bottom: 12px;
}
.section-screen {
  background: var(--display);
  margin: 12px;
  border-radius: var(--radius-display);
  padding: 20px 16px;
  position: relative;
}
.section-screen::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border-radius: var(--radius-display);
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
  pointer-events: none;
}
.section-label {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 1px;
  margin-bottom: 8px;
}
.section-title {
  font-family: var(--mono);
  font-size: 20px;
  font-weight: 600;
  color: var(--display-text);
  letter-spacing: 0.5px;
}
.section-subtitle {
  font-family: var(--mono);
  font-size: 13px;
  color: var(--display-dim);
  margin-top: 4px;
}

/* ═══ OVERVIEW: DAY CARD ═══ */
.day-overview {
  background: var(--housing);
  border-radius: var(--radius-device);
  box-shadow: var(--shadow-device);
  margin-bottom: 10px;
  overflow: hidden;
}
.day-overview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px 10px;
}
.day-overview-num {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 0.5px;
}
.day-overview-date {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-light);
}
.day-overview-title {
  padding: 0 16px 4px;
  font-family: var(--system);
  font-size: 17px;
  font-weight: 700;
  color: var(--item-text);
}
.day-overview-keyword {
  padding: 0 16px 12px;
  font-family: var(--system);
  font-size: 13px;
  color: var(--text-light);
}
.day-overview-items {
  padding: 0 16px 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.day-item-row {
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: var(--system);
  font-size: 14px;
  color: var(--item-text-mid);
}
.day-item-icon {
  width: 20px;
  text-align: center;
  flex-shrink: 0;
  font-size: 13px;
}
.day-item-text {
  flex: 1;
}
.day-item-chosen {
  font-family: var(--mono);
  font-size: 11px;
  color: #1A6B1A;
  font-weight: 600;
  flex-shrink: 0;
}
.day-item-optional {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-light);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 1px 4px;
  flex-shrink: 0;
}

/* ═══ PLACE GUIDE ═══ */
.place-card {
  background: var(--housing);
  border-radius: var(--radius-device);
  box-shadow: var(--shadow-device);
  margin-bottom: 12px;
  overflow: hidden;
}
.place-header {
  padding: 16px 16px 10px;
}
.place-name {
  font-family: var(--system);
  font-size: 18px;
  font-weight: 700;
  color: var(--item-text);
}
.place-subtitle {
  font-family: var(--system);
  font-size: 13px;
  color: var(--text-light);
  margin-top: 2px;
}
.place-section {
  padding: 0 16px 14px;
}
.place-section-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 0.5px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.place-list {
  list-style: none;
}
.place-list li {
  font-family: var(--system);
  font-size: 14px;
  color: var(--item-text-mid);
  padding: 4px 0;
  padding-left: 12px;
  position: relative;
  line-height: 1.5;
}
.place-list li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 11px;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: var(--accent);
}
.baby-tip-box {
  background: #F0F7FF;
  border-radius: 8px;
  padding: 12px 14px;
  margin-bottom: 10px;
}
.baby-tip-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 600;
  color: #1D4ED8;
  letter-spacing: 0.3px;
  margin-bottom: 4px;
}
.baby-tip-text {
  font-family: var(--system);
  font-size: 13px;
  color: #1A1A1A;
  line-height: 1.5;
}
.practical-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 4px 10px;
  font-family: var(--system);
  font-size: 13px;
}
.practical-label {
  color: var(--text-light);
  font-weight: 600;
  white-space: nowrap;
}
.practical-value {
  color: var(--item-text-mid);
}

/* ═══ RESTAURANT GUIDE ═══ */
.meal-group {
  background: var(--housing);
  border-radius: var(--radius-device);
  box-shadow: var(--shadow-device);
  margin-bottom: 12px;
  overflow: hidden;
}
.meal-group-header {
  padding: 14px 16px 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.meal-group-day {
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 0.5px;
}
.meal-group-time {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-light);
}

/* Primary restaurant */
.restaurant-primary {
  margin: 0 12px 12px;
  padding: 14px;
  background: var(--item-bg);
  border-radius: var(--radius-display);
  border-left: 3px solid var(--accent);
}
.rest-top-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}
.rest-name {
  font-family: var(--system);
  font-size: 16px;
  font-weight: 700;
  color: var(--item-text);
}
.rest-rating {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--accent);
}
.rest-rating-source {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-light);
  margin-left: 2px;
}
.rest-category {
  font-family: var(--system);
  font-size: 13px;
  color: var(--text-light);
  margin-bottom: 8px;
}
.rest-chosen-tag {
  display: inline-block;
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  color: #1A6B1A;
  background: #DEF7E5;
  border-radius: 4px;
  padding: 2px 6px;
  margin-left: 6px;
}
.rest-menu-list {
  margin-bottom: 8px;
}
.rest-menu-item {
  display: flex;
  justify-content: space-between;
  font-family: var(--system);
  font-size: 13px;
  color: var(--item-text-mid);
  padding: 2px 0;
}
.rest-menu-price {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-light);
  white-space: nowrap;
  margin-left: 8px;
}
.rest-info-row {
  font-family: var(--system);
  font-size: 12px;
  color: var(--text-light);
  padding: 2px 0;
}
.rest-badges {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 8px;
}
.badge {
  display: inline-block;
  padding: 3px 7px;
  border-radius: 4px;
  font-family: var(--system);
  font-size: 11px;
  font-weight: 600;
}
.badge-dad-good { background: #DEF7E5; color: #1A6B1A; }
.badge-dad-caution { background: #FDE8E0; color: #C04A1A; }
.badge-hiro-good { background: #DBEAFE; color: #1D4ED8; }
.badge-hiro-caution { background: #FEE2E2; color: #C53030; }
.rest-map-link {
  display: inline-block;
  margin-top: 8px;
  font-family: var(--system);
  font-size: 12px;
  font-weight: 600;
  color: var(--text-mid);
  text-decoration: none;
  border-bottom: 1px solid var(--border);
  padding-bottom: 1px;
}

/* Alternative restaurants (accordion) */
.rest-alternatives {
  margin: 0 12px 12px;
}
.rest-alternatives summary {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 600;
  color: var(--text-mid);
  cursor: pointer;
  padding: 8px 0;
  list-style: none;
  user-select: none;
}
.rest-alternatives summary::-webkit-details-marker { display: none; }
.rest-alternatives summary::before {
  content: '\25B8';
  display: inline-block;
  margin-right: 6px;
  transition: transform 0.15s;
}
.rest-alternatives[open] summary::before {
  transform: rotate(90deg);
}
.rest-alt-item {
  background: var(--item-bg);
  border-radius: 8px;
  padding: 12px 14px;
  margin-bottom: 8px;
}
.rest-alt-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 4px;
}
.rest-alt-name {
  font-family: var(--system);
  font-size: 14px;
  font-weight: 700;
  color: var(--item-text);
}
.rest-alt-rating {
  font-family: var(--mono);
  font-size: 13px;
  font-weight: 600;
  color: var(--accent);
}
.rest-alt-menu {
  font-family: var(--system);
  font-size: 13px;
  color: var(--item-text-mid);
  margin-bottom: 4px;
}
.rest-alt-price {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text-light);
  margin-bottom: 6px;
}
.rest-alt-badges {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}
.rest-alt-map-link {
  display: inline-block;
  margin-top: 6px;
  font-family: var(--system);
  font-size: 11px;
  color: var(--text-mid);
  text-decoration: none;
  border-bottom: 1px solid var(--border);
}

/* ═══ CAFE SECTION IN RESTAURANT GUIDE ═══ */
.cafe-primary {
  margin: 0 12px 12px;
  padding: 14px;
  background: var(--item-bg);
  border-radius: var(--radius-display);
  border-left: 3px solid #8B6F47;
}

/* ═══ FOOTER ═══ */
.footer {
  text-align: center;
  padding: 20px 16px 40px;
}
.footer-link {
  display: inline-block;
  font-family: var(--system);
  font-size: 14px;
  font-weight: 700;
  color: #fff;
  background: var(--text);
  border-radius: var(--radius-btn);
  padding: 12px 24px;
  text-decoration: none;
  box-shadow: var(--shadow-btn);
  transition: opacity 0.15s;
}
.footer-link:active { opacity: 0.8; }
.footer-note {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-light);
  margin-top: 12px;
}

/* ═══ SCROLL TO TOP ═══ */
.scroll-top {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--text);
  color: #fff;
  border: none;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
  z-index: 200;
}
.scroll-top.visible {
  opacity: 1;
  pointer-events: auto;
}

/* ═══ LOADING ═══ */
.loading {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-light);
  font-family: var(--system);
  font-size: 14px;
}
.loading .spinner {
  display: inline-block;
  width: 24px; height: 24px;
  border: 2px solid var(--border);
  border-top-color: var(--text);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-bottom: 12px;
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="header">
  <h1>경주 가족여행 가이드</h1>
  <div class="sub-info">2026.02.19(목) — 02.24(화)</div>
  <div class="sub-detail">5박 6일 · 까사멜로우</div>
  <a href="/" class="daily-link">일정 상세 보기</a>
</div>

<div class="section-nav">
  <button class="section-nav-btn active" onclick="scrollToSection('overview')">일정</button>
  <button class="section-nav-btn" onclick="scrollToSection('places')">장소</button>
  <button class="section-nav-btn" onclick="scrollToSection('restaurants')">식당</button>
</div>

<div class="container">
  <div id="contentArea">
    <div class="loading">
      <div class="spinner"></div>
      <div>가이드 불러오는 중...</div>
    </div>
  </div>
</div>

<button class="scroll-top" id="scrollTopBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>

<script>
let travelData = null;

// ═══ DATA FETCH ═══
(async function init() {
  try {
    const res = await fetch('/api/data');
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const json = await res.json();
    travelData = json.record;
    render();
  } catch (e) {
    document.getElementById('contentArea').innerHTML =
      '<div class="loading" style="color:#C04A1A">데이터를 불러올 수 없습니다. 새로고침해 주세요.</div>';
  }
})();

// ═══ RENDER ═══
function render() {
  if (!travelData) return;
  let html = '';
  html += renderOverviewSection(travelData.days);
  html += renderPlacesSection(travelData.days);
  html += renderRestaurantSection(travelData.days);
  html += renderFooter();
  document.getElementById('contentArea').innerHTML = html;
}

// ═══ ① OVERVIEW ═══
function renderOverviewSection(days) {
  let html = '<div id="overview">';
  html += '<div class="section-device"><div class="section-screen">';
  html += '<div class="section-label">OVERVIEW</div>';
  html += '<div class="section-title">일정 한눈에 보기</div>';
  html += '<div class="section-subtitle">6일간의 여행 요약</div>';
  html += '</div></div>';

  days.forEach(function(day) {
    html += '<div class="day-overview">';
    html += '<div class="day-overview-header">';
    html += '<span class="day-overview-num">DAY ' + day.dayNum + '</span>';
    html += '<span class="day-overview-date">' + formatDate(day.date) + ' ' + day.dow + '</span>';
    html += '</div>';
    html += '<div class="day-overview-title">' + esc(day.title) + '</div>';
    if (day.keyword) {
      html += '<div class="day-overview-keyword">' + esc(day.keyword) + '</div>';
    }
    html += '<div class="day-overview-items">';
    day.items.forEach(function(item) {
      var icon = item.cat === 'meal' ? '\uD83C\uDF7D' : item.cat === 'cafe' ? '\u2615' : '\uD83C\uDFDB';
      html += '<div class="day-item-row">';
      html += '<span class="day-item-icon">' + icon + '</span>';
      html += '<span class="day-item-text">' + esc(item.title);
      if (item.options && item.options.length > 0 && item.chosen) {
        html += ' <b>' + esc(item.chosen) + '</b>';
      }
      html += '</span>';
      if (item.chosen) {
        html += '<span class="day-item-chosen">확정</span>';
      }
      if (item.optional) {
        html += '<span class="day-item-optional">선택</span>';
      }
      html += '</div>';
    });
    html += '</div></div>';
  });
  html += '</div>';
  return html;
}

// ═══ ② PLACES GUIDE ═══
function renderPlacesSection(days) {
  var html = '<div id="places" style="margin-top:20px">';
  html += '<div class="section-device"><div class="section-screen">';
  html += '<div class="section-label">PLACES</div>';
  html += '<div class="section-title">장소 가이드</div>';
  html += '<div class="section-subtitle">주요 관광지 · 아이 동반 팁</div>';
  html += '</div></div>';

  // 고유 장소 추출 (guide 필드가 있는 activity)
  var seen = {};
  var places = [];
  days.forEach(function(day) {
    day.items.forEach(function(item) {
      if (item.cat === 'activity' && item.guide && !seen[item.id]) {
        seen[item.id] = true;
        places.push(item);
      }
    });
  });

  places.forEach(function(item) {
    var g = item.guide;
    html += '<div class="place-card">';
    html += '<div class="place-header">';
    html += '<div class="place-name">' + esc(item.title) + '</div>';
    if (g.subtitle) html += '<div class="place-subtitle">' + esc(g.subtitle) + '</div>';
    html += '</div>';

    // Must-Do
    if (g.mustDo && g.mustDo.length > 0) {
      html += '<div class="place-section">';
      html += '<div class="place-section-label">Must-Do</div>';
      html += '<ul class="place-list">';
      g.mustDo.forEach(function(m) { html += '<li>' + esc(m) + '</li>'; });
      html += '</ul></div>';
    }

    // Baby Tips
    if (g.babyTips) {
      var bt = g.babyTips;
      html += '<div class="place-section">';
      html += '<div class="place-section-label">아이 동반 팁</div>';

      if (bt.stroller) {
        html += '<div class="baby-tip-box">';
        html += '<div class="baby-tip-label">유모차</div>';
        html += '<div class="baby-tip-text">' + esc(bt.stroller) + '</div>';
        html += '</div>';
      }

      if (bt.restSpots && bt.restSpots.length > 0) {
        html += '<div class="baby-tip-box">';
        html += '<div class="baby-tip-label">쉴 곳</div>';
        bt.restSpots.forEach(function(s) {
          html += '<div class="baby-tip-text">' + esc(s) + '</div>';
        });
        html += '</div>';
      }

      if (bt.restroom) {
        html += '<div class="baby-tip-box">';
        html += '<div class="baby-tip-label">화장실</div>';
        html += '<div class="baby-tip-text">' + esc(bt.restroom) + '</div>';
        html += '</div>';
      }

      if (bt.nursingRoom) {
        html += '<div class="baby-tip-box">';
        html += '<div class="baby-tip-label">수유실</div>';
        html += '<div class="baby-tip-text">' + esc(bt.nursingRoom) + '</div>';
        html += '</div>';
      }

      if (bt.recommendedRoute) {
        html += '<div class="baby-tip-box">';
        html += '<div class="baby-tip-label">추천 동선</div>';
        html += '<div class="baby-tip-text">' + esc(bt.recommendedRoute) + '</div>';
        html += '</div>';
      }

      html += '</div>';
    }

    // Practical Info
    if (g.practicalInfo) {
      var pi = g.practicalInfo;
      html += '<div class="place-section">';
      html += '<div class="place-section-label">실용 정보</div>';
      html += '<div class="practical-grid">';
      if (pi.fee) { html += '<span class="practical-label">입장료</span><span class="practical-value">' + esc(pi.fee) + '</span>'; }
      if (pi.hours) { html += '<span class="practical-label">운영시간</span><span class="practical-value">' + esc(pi.hours) + '</span>'; }
      if (pi.parking) { html += '<span class="practical-label">주차</span><span class="practical-value">' + esc(pi.parking) + '</span>'; }
      if (pi.timeNeeded) { html += '<span class="practical-label">소요시간</span><span class="practical-value">' + esc(pi.timeNeeded) + '</span>'; }
      if (pi.fromAccommodation) { html += '<span class="practical-label">숙소에서</span><span class="practical-value">' + esc(pi.fromAccommodation) + '</span>'; }
      if (pi.closedDays) { html += '<span class="practical-label">휴무</span><span class="practical-value">' + esc(pi.closedDays) + '</span>'; }
      html += '</div></div>';
    }

    html += '</div>';
  });

  html += '</div>';
  return html;
}

// ═══ ③ RESTAURANTS ═══
function renderRestaurantSection(days) {
  var html = '<div id="restaurants" style="margin-top:20px">';
  html += '<div class="section-device"><div class="section-screen">';
  html += '<div class="section-label">RESTAURANTS</div>';
  html += '<div class="section-title">식당 가이드</div>';
  html += '<div class="section-subtitle">별점 · 메뉴 · 가격 · 알레르기 정보</div>';
  html += '</div></div>';

  days.forEach(function(day) {
    day.items.forEach(function(item) {
      if (item.cat !== 'meal' && item.cat !== 'cafe') return;
      if (!item.options || item.options.length === 0) return;

      var primary = null;
      var alternatives = [];

      if (item.chosen) {
        item.options.forEach(function(opt) {
          if (opt.name === item.chosen) primary = opt;
          else alternatives.push(opt);
        });
        if (!primary) { primary = item.options[0]; alternatives = item.options.slice(1); }
      } else {
        primary = item.options[0];
        alternatives = item.options.slice(1);
      }

      html += '<div class="meal-group">';
      html += '<div class="meal-group-header">';
      html += '<span class="meal-group-day">DAY ' + day.dayNum + ' ' + esc(item.time) + '</span>';
      html += '<span class="meal-group-time">' + esc(item.title) + '</span>';
      html += '</div>';

      // Primary
      html += renderPrimaryRestaurant(primary, item.chosen === primary.name, item.cat);

      // Alternatives
      if (alternatives.length > 0) {
        html += '<details class="rest-alternatives">';
        html += '<summary>다른 선택지 ' + alternatives.length + '곳</summary>';
        alternatives.forEach(function(alt) {
          html += renderAltRestaurant(alt);
        });
        html += '</details>';
      }

      html += '</div>';
    });
  });

  html += '</div>';
  return html;
}

function renderPrimaryRestaurant(opt, isChosen, cat) {
  var cls = cat === 'cafe' ? 'cafe-primary' : 'restaurant-primary';
  var html = '<div class="' + cls + '">';

  // Top row: name + rating
  html += '<div class="rest-top-row">';
  html += '<span class="rest-name">' + esc(opt.name);
  if (isChosen) html += '<span class="rest-chosen-tag">확정</span>';
  html += '</span>';
  if (opt.rating) {
    html += '<span class="rest-rating">' + opt.rating.toFixed(1);
    if (opt.ratingSource) html += '<span class="rest-rating-source">' + opt.ratingSource + '</span>';
    html += '</span>';
  }
  html += '</div>';

  // Category
  if (opt.category) {
    html += '<div class="rest-category">' + esc(opt.category) + '</div>';
  } else if (opt.desc) {
    html += '<div class="rest-category">' + esc(opt.desc) + '</div>';
  }

  // Menu detail (if available)
  if (opt.menuDetail && opt.menuDetail.length > 0) {
    html += '<div class="rest-menu-list">';
    opt.menuDetail.forEach(function(m) {
      html += '<div class="rest-menu-item">';
      html += '<span>' + esc(m.item) + '</span>';
      if (m.price) html += '<span class="rest-menu-price">' + formatPrice(m.price) + '</span>';
      html += '</div>';
    });
    html += '</div>';
  } else if (opt.menu) {
    html += '<div class="rest-info-row" style="color:var(--item-text-mid)">' + esc(opt.menu) + '</div>';
  }

  // Price range
  if (opt.priceRange) {
    html += '<div class="rest-info-row">가격대 ' + esc(opt.priceRange) + '</div>';
  }

  // Hours
  if (opt.hours) {
    html += '<div class="rest-info-row">' + esc(opt.hours) + '</div>';
  }

  // Location
  if (opt.loc) {
    html += '<div class="rest-info-row">' + esc(opt.loc) + '</div>';
  }

  // Badges
  var badges = buildBadges(opt);
  if (badges) html += '<div class="rest-badges">' + badges + '</div>';

  // Map link
  if (opt.mapUrl) {
    html += '<a class="rest-map-link" href="' + escAttr(opt.mapUrl) + '" target="_blank" rel="noopener">지도에서 보기 \u2192</a>';
  }

  html += '</div>';
  return html;
}

function renderAltRestaurant(opt) {
  var html = '<div class="rest-alt-item">';

  html += '<div class="rest-alt-top">';
  html += '<span class="rest-alt-name">' + esc(opt.name) + '</span>';
  if (opt.rating) {
    html += '<span class="rest-alt-rating">' + opt.rating.toFixed(1) + '</span>';
  }
  html += '</div>';

  if (opt.menu) {
    html += '<div class="rest-alt-menu">' + esc(opt.menu) + '</div>';
  } else if (opt.desc) {
    html += '<div class="rest-alt-menu">' + esc(opt.desc) + '</div>';
  }

  if (opt.priceRange) {
    html += '<div class="rest-alt-price">' + esc(opt.priceRange) + '</div>';
  }

  if (opt.hours) {
    html += '<div class="rest-alt-price">' + esc(opt.hours) + '</div>';
  }

  var badges = buildBadges(opt);
  if (badges) html += '<div class="rest-alt-badges">' + badges + '</div>';

  if (opt.mapUrl) {
    html += '<a class="rest-alt-map-link" href="' + escAttr(opt.mapUrl) + '" target="_blank" rel="noopener">지도 \u2192</a>';
  }

  html += '</div>';
  return html;
}

function buildBadges(opt) {
  var b = '';
  if (opt.dad === 'good') b += '<span class="badge badge-dad-good">아빠 OK</span>';
  if (opt.dad === 'caution') b += '<span class="badge badge-dad-caution">아빠 주의' + (opt.dadNote ? ' · ' + esc(opt.dadNote) : '') + '</span>';
  if (opt.hiro === 'good') b += '<span class="badge badge-hiro-good">히로 OK</span>';
  if (opt.hiro === 'caution') b += '<span class="badge badge-hiro-caution">히로 주의' + (opt.hiroNote ? ' · ' + esc(opt.hiroNote) : '') + '</span>';
  return b;
}

// ═══ FOOTER ═══
function renderFooter() {
  var html = '<div class="footer">';
  html += '<a href="/" class="footer-link">일정 상세 보기 \u2192</a>';
  html += '<div class="footer-note">식당 별점·가격은 참고용이며 현장과 다를 수 있습니다</div>';
  html += '</div>';
  return html;
}

// ═══ SECTION NAV ═══
function scrollToSection(id) {
  var el = document.getElementById(id);
  if (el) {
    var offset = 60;
    var y = el.getBoundingClientRect().top + window.pageYOffset - offset;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }
  // update active
  document.querySelectorAll('.section-nav-btn').forEach(function(btn) { btn.classList.remove('active'); });
  event.currentTarget.classList.add('active');
}

// Scroll spy for section nav
var spyTimer = null;
window.addEventListener('scroll', function() {
  // Scroll to top button
  var btn = document.getElementById('scrollTopBtn');
  if (window.scrollY > 400) btn.classList.add('visible');
  else btn.classList.remove('visible');

  // Section spy
  if (spyTimer) return;
  spyTimer = setTimeout(function() {
    spyTimer = null;
    var sections = ['overview', 'places', 'restaurants'];
    var active = sections[0];
    sections.forEach(function(id) {
      var el = document.getElementById(id);
      if (el && el.getBoundingClientRect().top < 100) active = id;
    });
    var idx = sections.indexOf(active);
    document.querySelectorAll('.section-nav-btn').forEach(function(btn, i) {
      btn.classList.toggle('active', i === idx);
    });
  }, 100);
});

// ═══ UTILS ═══
function formatDate(dateStr) {
  var p = dateStr.split('-');
  return parseInt(p[1]) + '/' + parseInt(p[2]);
}

function formatPrice(n) {
  if (!n) return '';
  return n.toLocaleString() + '원';
}

function esc(str) {
  if (!str) return '';
  var d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function escAttr(str) {
  return String(str).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
</script>
</body>
</html>
